{"version":3,"file":"SldStyleParser.js","sourceRoot":"","sources":["../../src/SldStyleParser.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,mDAiCyB;AAIzB,mDAKyB;AAEzB,0CASwB;AAaxB,IAAM,wBAAwB,GAAG,qBAAqB,CAAC;AAEvD;;;;;;GAMG;AACH;IA0FE,wBAAY,IAAwB;QAnFpC,UAAK,GAAG,kBAAkB,CAAC;QAE3B,0BAAqB,GAA0B;YAC7C,UAAU,EAAE;gBACV,cAAc,EAAE;oBACd,UAAU,EAAE,MAAM;oBAClB,IAAI,EAAE,MAAM;oBACZ,MAAM,EAAE,MAAM;oBACd,YAAY,EAAE,MAAM;oBACpB,cAAc,EAAE,MAAM;oBACtB,UAAU,EAAE,MAAM;oBAClB,UAAU,EAAE,MAAM;iBACnB;gBACD,cAAc,EAAE;oBACd,SAAS,EAAE,MAAM;oBACjB,OAAO,EAAE;wBACP,OAAO,EAAE,MAAM;wBACf,IAAI,EAAE,8EAA8E;qBACrF;oBACD,UAAU,EAAE,MAAM;iBACnB;gBACD,cAAc,EAAE;oBACd,YAAY,EAAE,MAAM;oBACpB,MAAM,EAAE,MAAM;oBACd,UAAU,EAAE,MAAM;oBAClB,KAAK,EAAE,MAAM;oBACb,QAAQ,EAAE,MAAM;oBAChB,SAAS,EAAE,MAAM;oBACjB,WAAW,EAAE,MAAM;oBACnB,SAAS,EAAE,MAAM;oBACjB,WAAW,EAAE,MAAM;oBACnB,MAAM,EAAE,MAAM;oBACd,YAAY,EAAE,MAAM;oBACpB,QAAQ,EAAE,MAAM;oBAChB,OAAO,EAAE,MAAM;oBACf,cAAc,EAAE,MAAM;oBACtB,iBAAiB,EAAE,MAAM;oBACzB,OAAO,EAAE,MAAM;oBACf,cAAc,EAAE,MAAM;oBACtB,UAAU,EAAE,MAAM;iBACnB;gBACD,cAAc,EAAE;oBACd,IAAI,EAAE,MAAM;oBACZ,QAAQ,EAAE,MAAM;oBAChB,QAAQ,EAAE,MAAM;oBAChB,UAAU,EAAE,MAAM;oBAClB,UAAU,EAAE,MAAM;oBAClB,OAAO,EAAE,MAAM;oBACf,UAAU,EAAE,MAAM;iBACnB;gBACD,gBAAgB,EAAE;oBAChB,aAAa,EAAE,MAAM;oBACrB,aAAa,EAAE,MAAM;oBACrB,QAAQ,EAAE,MAAM;oBAChB,YAAY,EAAE,MAAM;oBACpB,SAAS,EAAE,MAAM;oBACjB,UAAU,EAAE,MAAM;oBAClB,UAAU,EAAE,MAAM;oBAClB,UAAU,EAAE,MAAM;iBACnB;aACF;SACF,CAAC;QA8DF;;;WAGG;QACK,yBAAoB,GAAa,EAAE,CAAC;QAgB5C;;;WAGG;QACK,sBAAiB,GAAa,EAAE,CAAC;QAgBzC;;;WAGG;QACK,gBAAW,GAAe,OAAO,CAAC;QAkB1C;;;WAGG;QACK,qBAAgB,GAAW,OAAO,CAAC;QA8a3C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;WAwCG;QACH,4CAAuC,GAAG,UAAC,QAAa;YACtD,IAAM,KAAK,GAAW,QAAQ;iBAC3B,GAAG,CAAC,UAAC,OAAY;;gBAChB,IAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1C,QAAQ,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;oBACrC,KAAK,OAAO;wBACV,OAAO,OAAO,CAAC,OAAO,CAAC,CAAC;oBAC1B,KAAK,SAAS;wBACZ,OAAO,CAAA,MAAA,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAG,SAAS,CAAC,0CAAG,CAAC,CAAE,0CAAG,OAAO,CAAC,MAAI,MAAA,MAAA,MAAA,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAG,SAAS,CAAC,0CAAG,CAAC,CAAC,0CAAG,QAAQ,CAAC,0CAAG,CAAC,CAAC,0CAAG,OAAO,CAAC,CAAA,CAAC;oBACxG,KAAK,cAAc;wBACjB,IAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;wBAChD,OAAO,YAAK,QAAQ,OAAI,CAAC;oBAC3B;wBACE,OAAO,EAAE,CAAC;iBACb;YACH,CAAC,CAAC;iBACD,IAAI,CAAC,EAAE,CAAC,CAAC;YACZ,OAAO,KAAK,CAAC;QACf,CAAC,CAAC;QAgmCF;;;;WAIG;QACH,kCAA6B,GAAG,UAAC,QAA4B;YAC3D,gCAAgC;YAChC,IAAI,CAAC,CAAC,OAAO,QAAQ,KAAK,QAAQ,IAAI,QAAQ,YAAY,MAAM,CAAC,EAAE;gBACjE,OAAO,SAAS,CAAC;aAClB;YAED,IAAM,aAAa,GAAG,IAAI,CAAC;YAC3B,IAAM,aAAa,GAAG,IAAI,CAAC;YAE3B,IAAM,MAAM,GAAG,EAAE,CAAC;YAClB,IAAI,eAAe,GAAG,QAAQ,CAAC;YAE/B,OAAM,eAAe,CAAC,MAAM,EAAE;gBAC5B,IAAI,kBAAkB,GAAG,eAAe,CAAC;gBACzC,IAAI,qBAAqB,SAAA,CAAC;gBAC1B,IAAM,gBAAgB,GAAG,kBAAkB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;gBACnE,IAAI,gBAAgB,KAAK,CAAC,CAAC,EAAE;oBAC3B,IAAI,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;wBACjC,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,QAAQ,EAAE,CAAC;4CACT,OAAO,EAAE,eAAe;yCACzB,CAAC;iCACH,CAAC;yBACH,CAAC,CAAC;qBACJ;yBAAM;wBACL,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,OAAO,EAAE,eAAe;iCACzB,CAAC;yBACH,CAAC,CAAC;qBACJ;oBACD,MAAM;iBACP;gBAED,IAAI,gBAAgB,GAAG,CAAC,EAAE;oBACxB,qBAAqB,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;iBACvE;gBACD,kBAAkB,GAAG,kBAAkB,CAAC,KAAK,CAAC,gBAAgB,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC;gBAEvF,IAAM,gBAAgB,GAAG,kBAAkB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;gBACnE,IAAI,gBAAgB,KAAK,CAAC,CAAC,EAAE;oBAC3B,IAAI,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;wBACjC,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,QAAQ,EAAE,CAAC;4CACT,OAAO,EAAE,eAAe;yCACzB,CAAC;iCACH,CAAC;yBACH,CAAC,CAAC;qBACJ;yBAAM;wBACL,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,OAAO,EAAE,eAAe;iCACzB,CAAC;yBACH,CAAC,CAAC;qBACJ;oBACD,MAAM;iBACP;gBACD,IAAM,YAAY,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;gBACnE,kBAAkB,GAAG,kBAAkB,CAAC,KAAK,CAAC,gBAAgB,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC;gBACvF,IAAI,qBAAqB,EAAE;oBACzB,IAAI,qBAAqB,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;wBACvC,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,QAAQ,EAAE,CAAC;4CACT,OAAO,EAAE,qBAAqB;yCAC/B,CAAC;iCACH,CAAC;yBACH,CAAC,CAAC;qBACJ;yBAAM;wBACL,MAAM,CAAC,IAAI,CAAC;4BACV,aAAa,EAAE,CAAC;oCACd,OAAO,EAAE,qBAAqB;iCAC/B,CAAC;yBACH,CAAC,CAAC;qBACJ;iBACF;gBACD,MAAM,CAAC,IAAI,CAAC;oBACV,kBAAkB,EAAE,CAAC;4BACnB,OAAO,EAAE,YAAY;yBACtB,CAAC;iBACH,CAAC,CAAC;gBACH,eAAe,GAAG,kBAAkB,CAAC;aACtC;YAED,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC;QA9wDA,IAAI,CAAC,MAAM,GAAG,IAAI,2BAAS,uBACtB,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,aAAa;YACtB,mBAAmB;YACnB,aAAa,EAAE,QAAQ,EACvB,iBAAiB,EAAE,IAAI,EACvB,cAAc,EAAE,IAAI,EACpB,gBAAgB,EAAE,KAAK,EACvB,aAAa,EAAE,IAAI,IACnB,CAAC;QACH,IAAI,CAAC,OAAO,GAAG,IAAI,4BAAU,uBACxB,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,cAAc;YACvB,mBAAmB;YACnB,aAAa,EAAE,QAAQ,EACvB,gBAAgB,EAAG,KAAK,EACxB,iBAAiB,EAAE,IAAI,EACvB,aAAa,EAAE,IAAI,IACnB,CAAC;QACH,IAAI,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,UAAU,EAAE;YACpB,IAAI,CAAC,UAAU,GAAG,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,UAAU,CAAC;SACpC;QACD,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IAC5B,CAAC;IAGD,sBAAI,kCAAM;aAAV;YACE,OAAO,IAAI,CAAC,OAAO,CAAC;QACtB,CAAC;aACD,UAAW,MAAiB;YAC1B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACxB,CAAC;;;OAHA;IAMD,sBAAI,mCAAO;aAAX;YACE,OAAO,IAAI,CAAC,QAAQ,CAAC;QACvB,CAAC;aACD,UAAY,OAAmB;YAC7B,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QAC1B,CAAC;;;OAHA;IAcD,sBAAI,+CAAmB;QAJvB;;;WAGG;aACH;YACE,OAAO,IAAI,CAAC,oBAAoB,CAAC;QACnC,CAAC;QACD;;;WAGG;aACH,UAAwB,mBAA6B;YACnD,IAAI,CAAC,oBAAoB,GAAG,mBAAmB,CAAC;QAClD,CAAC;;;OAPA;IAkBD,sBAAI,4CAAgB;QAJpB;;;WAGG;aACH;YACE,OAAO,IAAI,CAAC,iBAAiB,CAAC;QAChC,CAAC;QACD;;;WAGG;aACH,UAAqB,gBAA0B;YAC7C,IAAI,CAAC,iBAAiB,GAAG,gBAAgB,CAAC;QAC5C,CAAC;;;OAPA;IAmBD,sBAAI,sCAAU;QAJd;;;WAGG;aACH;YACE,OAAO,IAAI,CAAC,WAAW,CAAC;QAC1B,CAAC;QAED;;;WAGG;aACH,UAAe,UAAsB;YACnC,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;QAChC,CAAC;;;OARA;IAoBD,sBAAI,2CAAe;QAJnB;;;WAGG;aACH;YACE,OAAO,IAAI,CAAC,gBAAgB,CAAC;QAC/B,CAAC;QAED;;;WAGG;aACH,UAAoB,eAAuB;YACzC,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QAC1C,CAAC;;;OARA;IAUD;;;;;;;OAOG;IACH,kCAAS,GAAT,UAAU,SAAiB;QAA3B,iBAcC;QAbC,OAAO,IAAI,OAAO,CAAkB,UAAC,OAAO;YAC1C,IAAI;gBACF,IAAM,SAAS,GAAG,KAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;gBAC/C,IAAM,cAAc,GAAU,KAAI,CAAC,yBAAyB,CAAC,SAAS,CAAC,CAAC;gBACxE,OAAO,CAAC;oBACN,MAAM,EAAE,cAAc;iBACvB,CAAC,CAAC;aACJ;YAAC,OAAO,KAAK,EAAE;gBACd,OAAO,CAAC;oBACN,MAAM,EAAE,CAAC,KAAK,CAAC;iBAChB,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACH,kDAAyB,GAAzB,UAA0B,SAAc;QACtC,IAAM,KAAK,GAAG,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC;QACpD,IAAM,IAAI,GAAG,IAAI,CAAC,yBAAyB,CAAC,SAAS,CAAC,CAAC;QACvD,OAAO;YACL,IAAI,MAAA;YACJ,KAAK,OAAA;SACN,CAAC;IACJ,CAAC;IAED;;;;;OAKG;IACH,8CAAqB,GAArB,UAAsB,SAAc;QAApC,iBAiCC;QAhCC,IAAM,MAAM,GAAG,IAAA,qBAAW,EAAC,SAAS,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE,YAAY,CAAC,CAAC;QAC7E,IAAM,KAAK,GAAa,EAAE,CAAC;QAC3B,MAAM,CAAC,OAAO,CAAC,UAAC,EAAwB;gBAAX,KAAK,gBAAA;YAChC,IAAA,qBAAW,EAAC,KAAK,EAAE,WAAW,CAAC,CAAC,OAAO,CAAC,UAAC,EAA2B;oBAAf,SAAS,eAAA;gBAC5D,IAAA,qBAAW,EAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC,OAAO,CAAC,UAAC,EAAyC;wBAAtB,gBAAgB,sBAAA;oBACrF,IAAA,qBAAW,EAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,UAAC,EAAoB;4BAAb,OAAO,UAAA;wBAC3D,IAAM,MAAM,GAAyB,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;wBACrE,IAAM,gBAAgB,GAAiC,KAAI,CAAC,2BAA2B,CAAC,OAAO,CAAC,CAAC;wBACjG,IAAM,WAAW,GAAiB,KAAI,CAAC,sBAAsB,CAAC,OAAO,CAAC,CAAC;wBACvE,IAAM,SAAS,GAAG,IAAA,aAAG,EAAC,OAAO,EAAE,aAAa,CAAC,CAAC;wBAC9C,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,OAAO,EAAE,YAAY,CAAC,CAAC;wBAC5C,IAAM,IAAI,GAAG,SAAS,KAAK,SAAS;4BAClC,CAAC,CAAC,SAAS;4BACX,CAAC,CAAC,CAAC,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;wBAC7C,IAAM,IAAI,GAAoB;4BAC5B,IAAI,MAAA;yBACL,CAAC;wBACF,IAAI,MAAM,EAAE;4BACV,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;yBACtB;wBACD,IAAI,gBAAgB,EAAE;4BACpB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;yBAC1C;wBACD,IAAI,WAAW,EAAE;4BACf,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;yBAChC;wBACD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACnB,CAAC,CAAC,CAAC;gBACL,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;;;;;OAMG;IACH,kDAAyB,GAAzB,UAA0B,SAAc;QACtC,IAAM,cAAc,GAAG,IAAA,aAAG,EAAC,SAAS,EAAE,2DAA2D,CAAC,CAAC;QACnG,IAAM,cAAc,GAAG,IAAA,aAAG,EAAC,SAAS,EAAE,6CAA6C,CAAC,CAAC;QACrF,OAAO,cAAc,CAAC,CAAC,CAAC,cAAc;YACpC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC;IAC3C,CAAC;IAED;;;;;;;OAOG;IACH,0CAAiB,GAAjB,UAAkB,OAAc;;QAC9B,IAAM,SAAS,GAAG,IAAA,aAAG,EAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QACzC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;YACxC,OAAO;SACR;QACD,IAAM,QAAQ,GAAG,MAAA,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,0CAAG,CAAC,CAAC,CAAC;QAChD,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO;SACR;QACD,IAAM,MAAM,GAAG,IAAI,CAAC,kCAAkC,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC5E,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;;;;OAKG;IACH,oDAA2B,GAA3B,UAA4B,OAAc;QACxC,IAAM,gBAAgB,GAAwC,EAAE,CAAC;QACjE,IAAM,GAAG,GAAG,IAAA,aAAG,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC;QACtD,IAAI,GAAG,EAAE;YACP,gBAAgB,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACpC;QACD,IAAM,GAAG,GAAG,IAAA,aAAG,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC;QACtD,IAAI,GAAG,EAAE;YACP,gBAAgB,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACpC;QAED,OAAO,CAAC,gBAAgB,CAAC,GAAG,IAAI,gBAAgB,CAAC,GAAG,CAAC;YACnD,CAAC,CAAC,gBAAgB;YAClB,CAAC,CAAC,SAAS,CAAC;IAChB,CAAC;IAED;;;;;OAKG;IACH,+CAAsB,GAAtB,UAAuB,OAAc;QAArC,iBAsBC;QArBC,IAAM,WAAW,GAAiB,OAAO;aACtC,MAAM,CAAC,sBAAY,CAAC;aACpB,GAAG,CAAC,UAAC,aAAkB;YACtB,IAAM,iBAAiB,GAAW,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;YAChE,QAAQ,iBAAiB,EAAE;gBACzB,KAAK,iBAAiB;oBACpB,OAAO,KAAI,CAAC,mCAAmC,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;gBACjF,KAAK,gBAAgB;oBACnB,OAAO,KAAI,CAAC,kCAAkC,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;gBAC/E,KAAK,gBAAgB;oBACnB,OAAO,KAAI,CAAC,kCAAkC,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;gBAC/E,KAAK,mBAAmB;oBACtB,OAAO,KAAI,CAAC,kCAAkC,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;gBAClF,KAAK,kBAAkB;oBACrB,OAAO,KAAI,CAAC,oCAAoC,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;gBACnF;oBACE,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;aAClE;QACH,CAAC,CAAC,CAAC;QAEL,OAAO,WAAW,CAAC;IACrB,CAAC;IAED;;;;;;;OAOG;IACH,2DAAkC,GAAlC,UAAmC,eAAuB,EAAE,SAAc;QAA1E,iBAqEC;;QApEC,IAAI,MAAgB,CAAC;QAErB,IAAI,eAAe,KAAK,UAAU,EAAE;YAClC,IAAM,YAAY,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC;YAClD,IAAM,gBAAgB,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACtF,eAAe,GAAG,oBAAa,gBAAgB,CAAE,CAAC;SACnD;QAED,gDAAgD;QAChD,gDAAgD;QAChD,mCAAmC;QACnC,IAAI,eAAe,KAAK,mBAAmB,EAAE;YAC3C,2FAA2F;YAC3F,IAAM,YAAY,GAAG,IAAA,aAAG,EAAC,SAAS,EAAE,sCAAsC,CAAC,CAAC;YAC5E,IAAM,KAAK,GAAG,MAAM,CAAC,IAAA,aAAG,EAAC,SAAS,EAAE,+CAA+C,CAAC,CAAC,CAAC;YACtF,IAAM,KAAK,GAAG,MAAM,CAAC,IAAA,aAAG,EAAC,SAAS,EAAE,+CAA+C,CAAC,CAAC,CAAC;YAEtF,MAAM,GAAG,CAAC,OAAO,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;SAChD;aAAM,IAAI,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;YAC9E,IAAM,kBAAkB,GAAuB,cAAc,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;YAC7F,IAAM,gBAAgB,GAAG,CAAC,CAAC,IAAA,aAAG,EAAC,SAAS,EAAE,UAAU,CAAC,CAAC;YACtD,IAAI,IAAI,GAAU,EAAE,CAAC;YACrB,IAAM,cAAc,GAAG,UAAC,KAAU;gBAChC,IAAI,IAAA,aAAG,EAAC,CAAC,KAAK,CAAC,EAAE,OAAO,CAAC,KAAK,SAAS,EAAE;oBACvC,OAAO,IAAA,aAAG,EAAC,CAAC,KAAK,CAAC,EAAE,OAAO,CAAC,CAAC;iBAC9B;qBAAM;oBACL,OAAO,IAAA,aAAG,EAAC,CAAC,KAAK,CAAC,EAAE,oBAAoB,CAAC,CAAC;iBAC3C;YACH,CAAC,CAAC;YAEF,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;YACvF,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;YAEpC,IAAI,eAAe,KAAK,gBAAgB,EAAE;gBACxC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;aAChB;YAED,MAAM,GAAG;gBACP,kBAAkB;eACf,IAAI,OACY,CAAC;SAEvB;aAAM,IAAI,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;YAC/E,IAAM,mBAAmB,GAAwB,cAAc,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;YAChG,IAAM,OAAO,GAAe,MAAA,IAAA,aAAG,EAAC,SAAS,EAAE,eAAe,CAAC,0CAAE,GAAG,CAAC,UAAC,EAAO;;gBACvE,IAAM,YAAY,GAAG,MAAA,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,0CAAG,CAAC,CAAC,CAAC;gBAC1C,OAAO,KAAI,CAAC,kCAAkC,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;YACnE,CAAC,CAAC,CAAC;YACH,MAAM;gBACJ,mBAAmB;eAChB,OAAO,OACX,CAAC;SACH;aAAM,IAAI,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;YACpF,IAAM,gBAAgB,GAAG,cAAc,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC;YAC7E,IAAM,eAAe,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACtE,IAAM,iBAAiB,GAAG,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;YACxD,IAAM,aAAa,GAAa,IAAI,CAAC,kCAAkC,CACrE,eAAe,EACf,iBAAiB,CAClB,CAAC;YACF,MAAM,GAAG;gBACP,gBAAgB;gBAChB,aAAa;aACd,CAAC;SACH;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;SACvC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;;;;;;OAOG;IACH,4DAAmC,GAAnC,UAAoC,aAAkB;QACpD,IAAI,eAAkC,CAAC;QACvC,IAAM,aAAa,GAAW,IAAA,aAAG,EAAC,aAAa,EAAE,kCAAkC,CAAC,CAAC;QACrF,IAAM,eAAe,GAAQ,IAAA,aAAG,EAAC,aAAa,EAAE,yBAAyB,CAAC,CAAC;QAC3E,IAAI,eAAe,EAAE;YACnB,eAAe,GAAG,IAAI,CAAC,kCAAkC,CAAC,aAAa,CAAC,CAAC;SAC1E;aAAM;YACL,8FAA8F;YAC9F,qFAAqF;YACrF,IAAI,CAAC,aAAa,EAAE;gBAClB,wCAAwC;gBACxC,0EAA0E;aAC3E;YACD,eAAe,GAAG,IAAI,CAAC,kCAAkC,CAAC,aAAa,CAAC,CAAC;SAC1E;QACD,OAAO,eAAe,CAAC;IACzB,CAAC;IAED;;;;;;;OAOG;IACH,2DAAkC,GAAlC,UAAmC,aAAkB;QACnD,IAAM,cAAc,GAAqB;YACvC,IAAI,EAAE,MAAM;SACb,CAAC;QACF,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,QAAQ,CAAC,CAAC;QAC9C,IAAM,KAAK,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACrE,IAAM,KAAK,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3E,IAAM,OAAO,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/E,IAAM,QAAQ,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,iBAAiB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACjF,IAAM,OAAO,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/E,IAAM,SAAS,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,kBAAkB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACnF,IAAM,UAAU,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,mBAAmB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAErF,IAAI,KAAK,EAAE;YACT,cAAc,CAAC,KAAK,GAAG,KAAK,CAAC;SAC9B;QACD,IAAI,KAAK,KAAK,SAAS,EAAE;YACvB,cAAc,CAAC,KAAK,GAAG,IAAA,0BAAgB,EAAC,KAAK,CAAC,CAAC;SAChD;QACD,IAAI,OAAO,KAAK,SAAS,EAAE;YACzB,cAAc,CAAC,OAAO,GAAG,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC;SACpD;QACD,IAAI,QAAQ,EAAE;YACZ,8DAA8D;YAC9D,IAAI,QAAQ,KAAK,OAAO,EAAE;gBACxB,cAAc,CAAC,IAAI,GAAG,OAAO,CAAC;aAC/B;iBAAM;gBACL,cAAc,CAAC,IAAI,GAAG,QAAmD,CAAC;aAC3E;SACF;QACD,IAAI,OAAO,EAAE;YACX,cAAc,CAAC,GAAG,GAAG,OAAkD,CAAC;SACzE;QAED,IAAI,SAAS,EAAE;YACb,IAAM,iBAAiB,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,0BAAgB,CAAC,CAAC;YACrE,cAAc,CAAC,SAAS,GAAG,iBAAiB,CAAC;SAC9C;QACD,IAAI,UAAU,EAAE;YACd,cAAc,CAAC,UAAU,GAAG,IAAA,0BAAgB,EAAC,UAAU,CAAC,CAAC;SAC1D;QAED,IAAM,aAAa,GAAG,IAAA,aAAG,EAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;QACrD,IAAI,aAAa,KAAK,SAAS,EAAE;YAC/B,cAAc,CAAC,aAAa,GAAG,IAAI,CAAC,mCAAmC,CAAC,aAAa,CAAC,CAAC;SACxF;QAED,IAAM,WAAW,GAAG,IAAA,aAAG,EAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;QACjD,IAAI,WAAW,KAAK,SAAS,EAAE;YAC7B,cAAc,CAAC,WAAW,GAAG,IAAI,CAAC,mCAAmC,CAAC,WAAW,CAAC,CAAC;SACpF;QAED,IAAM,mBAAmB,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,2BAA2B,CAAC,CAAC;QAC5E,IAAI,mBAAmB,KAAK,SAAS,EAAE;YACrC,cAAc,CAAC,mBAAmB,GAAG,IAAA,0BAAgB,EAAC,mBAAmB,CAAC,CAAC;SAC5E;QAED,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;;OAKG;IACH,2DAAkC,GAAlC,UAAmC,aAAkB;QACnD,IAAM,cAAc,GAAqB;YACvC,IAAI,EAAE,MAAM;SACb,CAAC;QACF,IAAM,MAAM,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAM,MAAM,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAM,OAAO,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,OAAO,CAAC,CAAC;QAC5C,IAAM,MAAM,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAM,UAAU,GAAG,IAAA,aAAG,EAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAEvC,IAAM,KAAK,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACjE,IAAM,OAAO,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAE3E,IAAM,UAAU,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC7E,IAAM,SAAS,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3E,IAAM,QAAQ,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACzE,IAAM,UAAU,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAE7E,IAAM,SAAS,GAAG,IAAA,2BAAiB,EAAC,UAAU,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAEzE,IAAI,OAAO,EAAE;YACX,cAAc,CAAC,KAAK,GAAG,IAAI,CAAC,uCAAuC,CAAC,OAAO,CAAC,CAAC;SAC9E;QAED,cAAc,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC;QACjD,cAAc,CAAC,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjE,IAAM,UAAU,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,mBAAmB,CAAC,CAAC;QAC3D,IAAI,UAAU,EAAE;YACd,cAAc,CAAC,SAAS,GAAG,IAAA,0BAAgB,EAAC,UAAU,CAAC,CAAC;SACzD;QACD,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,UAAU,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACnF,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,IAAA,0BAAgB,EAAC,WAAW,CAAC,CAAC;SAC5D;QACD,IAAI,SAAS,EAAE;YACb,cAAc,CAAC,SAAS,GAAG,SAAS,CAAC;SACtC;QACD,IAAM,YAAY,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,4CAA4C,CAAC,CAAC;QACtF,IAAI,YAAY,EAAE;YAChB,IAAM,CAAC,GAAG,IAAA,aAAG,EAAC,YAAY,EAAE,qBAAqB,CAAC,CAAC;YACnD,IAAM,CAAC,GAAG,IAAA,aAAG,EAAC,YAAY,EAAE,qBAAqB,CAAC,CAAC;YACnD,cAAc,CAAC,MAAM,GAAG;gBACtB,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrB,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aACtB,CAAC;SACH;QACD,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,8CAA8C,CAAC,CAAC;QACpF,IAAI,QAAQ,EAAE;YACZ,cAAc,CAAC,MAAM,GAAG,IAAA,0BAAgB,EAAC,QAAQ,CAAC,CAAC;SACpD;QACD,IAAI,UAAU,EAAE;YACd,cAAc,CAAC,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC;SACpC;QACD,IAAI,SAAS,EAAE;YACb,cAAc,CAAC,SAAS,GAAG,SAAS,CAAC,WAAW,EAAiD,CAAC;SACnG;QACD,IAAI,UAAU,EAAE;YACd,cAAc,CAAC,UAAU,GAAG,UAAU,CAAC,WAAW,EAAmC,CAAC;SACvF;QACD,IAAI,QAAQ,EAAE;YACZ,cAAc,CAAC,IAAI,GAAG,IAAA,0BAAgB,EAAC,QAAQ,CAAC,CAAC;SAClD;QACD,OAAO,cAAc,CAAC;IACxB,CAAC;IA+DD;;;;;;;OAOG;IACH,2DAAkC,GAAlC,UAAmC,aAAkB;QACnD,IAAM,cAAc,GAAqB;YACvC,IAAI,EAAE,MAAM;SACb,CAAC;QACF,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,QAAQ,CAAC,CAAC;QAC9C,IAAM,MAAM,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAE1C,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/E,IAAM,KAAK,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAEjE,IAAM,YAAY,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC5E,IAAM,YAAY,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAClF,IAAM,cAAc,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACtF,IAAM,gBAAgB,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,kBAAkB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC1F,IAAM,UAAU,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAClF,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,iBAAiB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACpF,+FAA+F;QAE/F,IAAM,WAAW,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,kBAAkB,CAAC,CAAC;QAC3D,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,IAAI,CAAC,mCAAmC,CACnE,WAAW,CACZ,CAAC;SACH;QACD,IAAI,KAAK,EAAE;YACT,cAAc,CAAC,KAAK,GAAG,KAAK,CAAC;SAC9B;QACD,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,IAAA,0BAAgB,EAAC,WAAW,CAAC,CAAC;SAC5D;QAED,IAAI,YAAY,EAAE;YAChB,cAAc,CAAC,YAAY,GAAG,YAAY,CAAC;SAC5C;QACD,IAAI,YAAY,EAAE;YAChB,cAAc,CAAC,YAAY,GAAG,IAAA,0BAAgB,EAAC,YAAY,CAAC,CAAC;SAC9D;QACD,IAAI,cAAc,EAAE;YAClB,cAAc,CAAC,cAAc,GAAG,IAAA,0BAAgB,EAAC,cAAc,CAAC,CAAC;SAClE;QACD,IAAI,gBAAgB,EAAE;YACpB,cAAc,CAAC,gBAAgB,GAAG,gBAAgB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,0BAAgB,CAAC,CAAC;SACrF;QACD,IAAI,UAAU,EAAE;YACd,cAAc,CAAC,UAAU,GAAG,UAAU,CAAC;SACxC;QACD,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,WAAW,CAAC;SAC1C;QACD,yDAAyD;QACzD,2BAA2B;QAC3B,kEAAkE;QAClE,IAAI;QACJ,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;OAIG;IACH,6DAAoC,GAApC,UAAqC,aAAkB;QACrD,IAAM,gBAAgB,GAAuB;YAC3C,IAAI,EAAE,QAAQ;SACf,CAAC;QACA,gBAAgB;QAClB,IAAI,OAAO,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,eAAe,CAAC,CAAC;QAClD,IAAI,OAAO,EAAE;YACX,OAAO,GAAG,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC;YACpC,gBAAgB,CAAC,OAAO,GAAG,OAAO,CAAC;SACpC;QACD,iBAAiB;QACjB,IAAM,WAAW,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACnD,IAAM,eAAe,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,gBAAgB,CAAC,CAAC;QAC7D,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,oBAAoB,CAAC,CAAC;QAC1D,IAAI,WAAW,EAAE;YACf,IAAM,QAAQ,GAAG,IAAI,CAAC,0BAA0B,CAAC,WAAW,EAAE,eAAe,EAAE,QAAQ,CAAC,CAAC;YACzF,gBAAgB,CAAC,QAAQ,GAAG,QAAQ,CAAC;SACtC;QACD,yBAAyB;QACzB,IAAM,mBAAmB,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,kBAAkB,CAAC,CAAC;QACnE,IAAI,mBAAmB,EAAE;YACvB,IAAM,gBAAgB,GAAG,IAAI,CAAC,0CAA0C,CAAC,mBAAmB,CAAC,CAAC;YAC9F,gBAAgB,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;SACtD;QACD,4BAA4B;QAC5B,IAAM,sBAAsB,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,qBAAqB,CAAC,CAAC;QACzE,IAAI,sBAAsB,EAAE;YAC1B,IAAM,mBAAmB,GAAG,IAAI,CAAC,gDAAgD,CAAC,sBAAsB,CAAC,CAAC;YAC1G,gBAAgB,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;SAC5D;QACD,OAAO,gBAAgB,CAAC;IAC1B,CAAC;IAED;;;;;OAKG;IACH,2DAAkC,GAAlC,UAAmC,aAAkB;QACnD,IAAM,aAAa,GAAoB,IAAA,aAAG,EAAC,aAAa,EAAE,kCAAkC,CAAC,CAAC;QAC9F,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,qBAAqB,CAAC,CAAC;QAC3D,IAAM,MAAM,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,mBAAmB,CAAC,CAAC;QAEvD,IAAM,OAAO,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,uBAAuB,CAAC,CAAC;QAC5D,IAAM,IAAI,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,oBAAoB,CAAC,CAAC;QACtD,IAAM,QAAQ,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,wBAAwB,CAAC,CAAC;QAC9D,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/E,IAAM,KAAK,GAAG,IAAA,2BAAiB,EAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAEjE,IAAM,cAAc,GAAqB;YACvC,IAAI,EAAE,MAAM;YACZ,aAAa,EAAE,QAAQ;SACxB,CAAC;QAEF,IAAI,OAAO,EAAE;YACX,cAAc,CAAC,OAAO,GAAG,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC;SACpD;QACD,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,IAAA,0BAAgB,EAAC,WAAW,CAAC,CAAC;SAC5D;QACD,IAAI,KAAK,EAAE;YACT,cAAc,CAAC,KAAK,GAAG,KAAK,CAAC;SAC9B;QACD,IAAI,QAAQ,EAAE;YACZ,cAAc,CAAC,MAAM,GAAG,IAAA,0BAAgB,EAAC,QAAQ,CAAC,CAAE;SACrD;QACD,IAAI,IAAI,EAAE;YACR,8FAA8F;YAC9F,cAAc,CAAC,MAAM,GAAG,IAAA,2CAAyB,EAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACnF;QAED,QAAQ,aAAa,EAAE;YACrB,KAAK,QAAQ,CAAC;YACd,KAAK,QAAQ,CAAC;YACd,KAAK,UAAU,CAAC;YAChB,KAAK,MAAM,CAAC;YACZ,KAAK,OAAO,CAAC;YACb,KAAK,GAAG,CAAC;YACT,KAAK,kBAAkB,CAAC;YACxB,KAAK,iBAAiB,CAAC;YACvB,KAAK,eAAe,CAAC;YACrB,KAAK,mBAAmB,CAAC;YACzB,KAAK,aAAa,CAAC;YACnB,KAAK,cAAc,CAAC;YACpB,KAAK,eAAe,CAAC;YACrB,KAAK,gBAAgB,CAAC;YACtB,KAAK,gBAAgB;gBACnB,cAAc,CAAC,aAAa,GAAG,aAAa,CAAC;gBAC7C,MAAM;YACR;gBACE,IAAI,wBAAwB,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;oBAChD,cAAc,CAAC,aAAa,GAAG,aAAa,CAAC;oBAC7C,MAAM;iBACP;gBACD,MAAM,IAAI,KAAK,CAAC,6DAA6D,CAAC,CAAC;SAClF;QAED,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3E,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,WAAW,CAAC;SAC1C;QACD,IAAM,WAAW,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACjF,IAAI,WAAW,EAAE;YACf,cAAc,CAAC,WAAW,GAAG,IAAA,0BAAgB,EAAC,WAAW,CAAC,CAAC;SAC5D;QACD,IAAM,aAAa,GAAG,IAAA,2BAAiB,EAAC,QAAQ,EAAE,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACrF,IAAI,aAAa,EAAE;YACjB,cAAc,CAAC,aAAa,GAAG,IAAA,0BAAgB,EAAC,aAAa,CAAC,CAAC;SAChE;QAED,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;;OAKG;IACH,2DAAkC,GAAlC,UAAmC,aAAkB;QACnD,IAAM,KAAK,GAAG,IAAA,aAAG,EAAC,aAAa,EAAE,8CAA8C,CAAC,CAAC;QACjF,IAAM,cAAc,GAAwC;YAC1D,IAAI,EAAE,MAAM;YACZ,KAAK,OAAA;SACN,CAAC;QACF,IAAM,OAAO,GAAW,IAAA,aAAG,EAAC,aAAa,EAAE,uBAAuB,CAAC,CAAC;QACpE,IAAM,IAAI,GAAW,IAAA,aAAG,EAAC,aAAa,EAAE,oBAAoB,CAAC,CAAC;QAC9D,IAAM,QAAQ,GAAW,IAAA,aAAG,EAAC,aAAa,EAAE,wBAAwB,CAAC,CAAC;QACtE,IAAI,OAAO,EAAE;YACX,cAAc,CAAC,OAAO,GAAG,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC;SACpD;QACD,IAAI,IAAI,EAAE;YACR,cAAc,CAAC,IAAI,GAAG,IAAA,0BAAgB,EAAC,IAAI,CAAC,CAAC;SAC9C;QACD,IAAI,QAAQ,EAAE;YACZ,cAAc,CAAC,MAAM,GAAG,IAAA,0BAAgB,EAAC,QAAQ,CAAC,CAAC;SACpD;QACD,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;OAIG;IACH,mDAA0B,GAA1B,UAA2B,WAAgB,EAAE,IAA2B,EAAE,QAAiB;QAA9C,qBAAA,EAAA,aAA2B;QACtE,IAAM,QAAQ,GAAa;YACzB,IAAI,MAAA;SACL,CAAC;QAEF,IAAI,QAAQ,EAAE;YACZ,IAAI,QAAQ,KAAK,MAAM,EAAE;gBACvB,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;aAC1B;iBAAM;gBACL,QAAQ,CAAC,QAAQ,GAAG,KAAK,CAAC;aAC3B;SACF;QAED,IAAM,eAAe,GAAG,IAAA,qBAAW,EAAC,WAAW,EAAE,eAAe,CAAC,CAAC;QAClE,IAAI,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE;YAClC,IAAM,SAAS,GAAG,eAAe,CAAC,GAAG,CAAC,UAAC,EAAE;gBACvC,IAAM,KAAK,GAAG,IAAA,sBAAY,EAAC,EAAE,EAAE,OAAO,CAAC,CAAC;gBACxC,IAAI,CAAC,KAAK,EAAE;oBACV,MAAM,IAAI,KAAK,CAAC,mDAAmD,CAAC,CAAC;iBACtE;gBACD,IAAI,QAAQ,GAAG,IAAA,sBAAY,EAAC,EAAE,EAAE,UAAU,CAAC,CAAC;gBAC5C,IAAI,QAAQ,EAAE;oBACZ,QAAQ,GAAG,IAAA,0BAAgB,EAAC,QAAQ,CAAC,CAAC;iBACvC;gBACD,IAAM,KAAK,GAAG,IAAA,sBAAY,EAAC,EAAE,EAAE,OAAO,CAAC,CAAC;gBACxC,IAAI,OAAO,GAAG,IAAA,sBAAY,EAAC,EAAE,EAAE,SAAS,CAAC,CAAC;gBAC1C,IAAI,OAAO,EAAE;oBACX,OAAO,GAAG,IAAA,0BAAgB,EAAC,OAAO,CAAC,CAAC;iBACrC;gBACD,OAAO;oBACL,KAAK,OAAA;oBACL,QAAQ,UAAA;oBACR,KAAK,OAAA;oBACL,OAAO,SAAA;iBACS,CAAC;YACrB,CAAC,CAAC,CAAC;YACH,QAAQ,CAAC,eAAe,GAAG,SAAS,CAAC;SACtC;QAED,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED;;;;OAIG;IACH,yEAAgD,GAAhD,UAAiD,sBAA2B;QAC1E,IAAM,mBAAmB,GAAwB,EAAE,CAAC;QAEpD,wBAAwB;QACxB,IAAM,YAAY,GAAG,CAAC,CAAC,IAAA,aAAG,EAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC;QAChE,IAAM,YAAY,GAAG,CAAC,CAAC,IAAA,aAAG,EAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC;QAChE,IAAI,YAAY,IAAI,YAAY,EAAE;YAChC,MAAM,IAAI,KAAK,CAAC,4FACU,CAAC,CAAC;SAC7B;aAAM,IAAI,YAAY,EAAE;YACvB,mBAAmB,CAAC,eAAe,GAAG,WAAW,CAAC;SACnD;aAAM,IAAI,YAAY,EAAE;YACvB,mBAAmB,CAAC,eAAe,GAAG,WAAW,CAAC;SACnD;QACD,mBAAmB;QACnB,IAAI,UAAU,GAAG,IAAA,aAAG,EAAC,sBAAsB,EAAE,kBAAkB,CAAC,CAAC;QACjE,IAAI,UAAU,EAAE;YACd,UAAU,GAAG,IAAA,0BAAgB,EAAC,UAAU,CAAC,CAAC;SAC3C;QACD,mBAAmB,CAAC,UAAU,GAAG,UAAU,CAAC;QAE5C,OAAO,mBAAmB,CAAC;IAC7B,CAAC;IAED;;;;OAIG;IACH,iDAAwB,GAAxB,UAAyB,UAAe;;QACtC,IAAM,iBAAiB,GAAG,MAAA,IAAA,aAAG,EAAC,UAAU,EAAE,yBAAyB,CAAC,0CAAE,QAAQ,EAAE,CAAC;QACjF,IAAM,OAAO,GAAY;YACvB,iBAAiB,mBAAA;SAClB,CAAC;QACF,IAAM,mBAAmB,GAAG,IAAA,aAAG,EAAC,UAAU,EAAE,qBAAqB,CAAC,CAAC;QACnE,IAAI,mBAAmB,EAAE;YACvB,OAAO,CAAC,mBAAmB,GAAG,IAAI,CAAC,gDAAgD,CAAC,mBAAmB,CAAC,CAAC;SAC1G;QACD,OAAO,OAAO,CAAC;IACjB,CAAC;IAED;;;;OAIG;IACH,mEAA0C,GAA1C,UAA2C,mBAAwB;QACjE,IAAI,gBAAkC,CAAC;QACvC,IAAM,GAAG,GAAG,IAAA,aAAG,EAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;QACnD,IAAM,IAAI,GAAG,IAAA,aAAG,EAAC,mBAAmB,EAAE,aAAa,CAAC,CAAC;QACrD,IAAM,KAAK,GAAG,IAAA,aAAG,EAAC,mBAAmB,EAAE,cAAc,CAAC,CAAC;QACvD,IAAM,IAAI,GAAG,IAAA,aAAG,EAAC,mBAAmB,EAAE,aAAa,CAAC,CAAC;QAErD,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,KAAK,EAAE;YAChC,MAAM,IAAI,KAAK,CAAC,yEAAyE,CAAC,CAAC;SAC5F;QACD,IAAI,IAAI,EAAE;YACR,IAAM,WAAW,GAAG,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;YACxD,gBAAgB,GAAG;gBACjB,WAAW,aAAA;aACZ,CAAC;SACH;aAAM,IAAI,GAAG,IAAI,KAAK,IAAI,IAAI,EAAE;YAC/B,IAAM,UAAU,GAAG,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC;YACtD,IAAM,WAAW,GAAG,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;YACxD,IAAM,YAAY,GAAG,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;YAC1D,gBAAgB,GAAG;gBACjB,UAAU,YAAA;gBACV,WAAW,aAAA;gBACX,YAAY,cAAA;aACb,CAAC;SACH;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,8EAA8E,CAAC,CAAC;SACjG;QACD,OAAO,gBAAgB,CAAC;IAC1B,CAAC;IAED;;;;;;;OAOG;IACH,mCAAU,GAAV,UAAW,cAAqB;QAAhC,iBAiBC;QAhBC,OAAO,IAAI,OAAO,CAA2B,UAAA,OAAO;YAClD,IAAM,qBAAqB,GAAG,KAAI,CAAC,6BAA6B,CAAC,cAAc,CAAC,CAAC;YACjF,IAAI;gBACF,IAAM,SAAS,GAAG,KAAI,CAAC,yBAAyB,CAAC,cAAc,CAAC,CAAC;gBACjE,IAAM,SAAS,GAAG,KAAI,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;gBAChD,OAAO,CAAC;oBACN,MAAM,EAAE,SAAS;oBACjB,qBAAqB,uBAAA;oBACrB,QAAQ,EAAE,qBAAqB,IAAI,CAAC,4CAA4C,CAAC;iBAClF,CAAC,CAAC;aACJ;YAAC,OAAO,KAAK,EAAE;gBACd,OAAO,CAAC;oBACN,MAAM,EAAE,CAAC,KAAK,CAAC;iBAChB,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACH,mCAAU,GAAV,UAAW,OAAe;QACxB,IAAM,OAAO,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC3B,IAAI,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;YAC7B,OAAO,IAAI,CAAC,UAAU,KAAK,OAAO,CAAC,CAAC,CAAC,cAAO,OAAO,CAAE,CAAC,CAAC,CAAC,OAAO,CAAC;SACjE;QACD,IAAI,OAAO,KAAK,cAAc,EAAE;YAC9B,OAAO,IAAI,CAAC,UAAU,KAAK,OAAO,CAAC,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC,cAAc,CAAC;SACzE;QACD,OAAO,IAAI,CAAC,UAAU,KAAK,OAAO,CAAC,CAAC,CAAC,aAAM,OAAO,CAAE,CAAC,CAAC,CAAC,OAAO,CAAC;IACjE,CAAC;IAED;;;;;OAKG;IACH,kDAAyB,GAAzB,UAA0B,cAAqB;;QAC7C,IAAM,KAAK,GAAU,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QACrE,sEAAsE;QACtE,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI;YAChB,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;gBAC1C,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,4BAA4B,CAAC;aACvD;QACH,CAAC,CAAC,CAAC;QAEH,IAAM,gBAAgB,qBACjB,KAAK,OACT,CAAC;QACF,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACvC,IAAM,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;QAE7D,IAAM,UAAU,GAAG;YACjB,WAAW,EAAE,IAAI,CAAC,UAAU;YAC5B,sBAAsB,EAAE,sDAAsD;YAC9E,SAAS,EAAE,4BAA4B;YACvC,aAAa,EAAE,4BAA4B;YAC3C,eAAe,EAAE,8BAA8B;YAC/C,aAAa,EAAE,2CAA2C;SAC3D,CAAC;QAEF,IAAI,IAAI,CAAC,UAAU,KAAK,OAAO,EAAE;YAC/B,UAAU,CAAC,YAAY,CAAC,GAAG,2BAA2B,CAAC;SACxD;QAED,OAAO,CAAC;gBACN,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;gBACzB,IAAI,EAAE;oBACJ,WAAW,EAAE,KAAK;oBAClB,YAAY,EAAE,OAAO;oBACrB,cAAc,EAAE,KAAK;iBACtB;aACF,EAAE;gBACD,qBAAqB,EAAE,CAAC;wBACtB,UAAU,EAAE;gCACV,GAAC,IAAI,IAAG,CAAC,EAAE,OAAO,EAAE,cAAc,CAAC,IAAI,IAAI,EAAE,EAAE,CAAC;qCAC/C;gCACD,SAAS,EAAE;wCACT,GAAC,IAAI,IAAG,CAAC,EAAE,OAAO,EAAE,cAAc,CAAC,IAAI,IAAI,EAAE,EAAE,CAAC;;wCAEhD,GAAC,KAAK,IAAG,CAAC,EAAE,OAAO,EAAE,cAAc,CAAC,IAAI,IAAI,EAAE,EAAE,CAAC;;wCAEjD,GAAC,gBAAgB,IAAG,gBAAgB;4CACpC;6BACH,CAAC;qBACH,CAAC;gBACF,IAAI,EAAE,UAAU;aACjB,CAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACH,6CAAoB,GAApB,UAAqB,KAAe;QAApC,iBA8DC;QA7DC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,mBAAmB,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,CAAC;QACnE,IAAM,mBAAmB,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,CAAC;QAEnE,OAAO,KAAK,CAAC,GAAG,CAAC,UAAC,IAAY;;YAC5B,IAAM,OAAO;gBACX,GAAC,IAAI,IAAG,EAAE;mBACX,CAAC;YACF,IAAI,IAAI,CAAC,IAAI,EAAE;gBACb,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI;oBAChB,GAAC,IAAI,IAAG,CAAC;4BACP,OAAO,EAAE,IAAI,CAAC,IAAI;yBACnB,CAAC;wBACF,CAAC;aACJ;YACD,IAAI,IAAI,CAAC,MAAM,EAAE;gBACf,IAAM,MAAM,GAAG,KAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACxD,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI;oBAChB,GAAC,MAAM,IAAG,MAAM;wBAChB,CAAC;aACJ;YACD,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBACnB,IAAA,KAAe,IAAI,CAAC,gBAAgB,EAAlC,GAAG,SAAA,EAAE,GAAG,SAA0B,CAAC;gBAC3C,IAAI,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;oBAC/B,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI;wBAChB,GAAC,mBAAmB,IAAG,CAAC;gCACtB,OAAO,EAAE,GAAG;6BACb,CAAC;4BACF,CAAC;iBACJ;gBACD,IAAI,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;oBAC/B,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI;wBAChB,GAAC,mBAAmB,IAAG,CAAC;gCACtB,OAAO,EAAE,GAAG;6BACb,CAAC;4BACF,CAAC;iBACJ;aACF;YAED,uEAAuE;YACvE,IAAM,WAAW,GAAG,KAAI,CAAC,gCAAgC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC5E,IAAI,cAAc,GAAa,EAAE,CAAC;YAClC,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC1B,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;aAC9C;YACD,cAAc,CAAC,OAAO,CAAC,UAAC,GAAW;gBACjC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;oBACpC,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;iBAC5B;YACH,CAAC,CAAC,CAAC;YAEH,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,IAAI,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;gBACzD,OAAO,CAAC,IAAI,CAAC,mCACR,OAAO,CAAC,IAAI,CAAC,SACb,WAAW,OACf,CAAC;aACH;YACD,OAAO,OAAO,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;;;;OAMG;IACH,mEAA0C,GAA1C,UAA2C,gBAAkC;;QAC3E,IAAM,mBAAmB,GAAQ,EAAE,CAAC;QACpC,IAAM,QAAQ,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;QACrC,IAAM,GAAG,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;QAChC,IAAM,KAAK,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;QAElC,IAAM,YAAY,GAAa,IAAA,qBAAW,EAAC,cAAc,CAAC,aAAa,EAAE,QAAQ,CAAC,CAAC;QACnF,IAAM,WAAW,GAAW,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,IAAI,KAAK,KAAK,IAAI,CAAC;YACrE,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAEtC,IAAM,WAAW,GAAG,cAAc,CAAC;QAEnC,IAAI,IAAA,qCAAmB,EAAC,GAAG,CAAC,IAAI,IAAA,qCAAmB,EAAC,KAAK,CAAC,EAAE;YAC1D,IAAM,YAAY,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;YAC3D,IAAM,mBAAmB,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACzF,IAAM,SAAS,GAAG,IAAA,qCAAmB,EAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAA,wCAA8B,EAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;YACvF,IAAM,WAAW,GAAG,IAAA,qCAAmB,EAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAA,wCAA8B,EAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YAE/F,IAAM,gBAAgB,GAAQ,EAAE,CAAC;YAEjC,IAAI,IAAA,qCAAmB,EAAC,GAAG,CAAC,EAAE;gBAC5B,gBAAgB,CAAC,OAAO,CAAC,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAG,CAAC,CAAC,CAAC,CAAC;aAC1C;iBAAM;gBACL,gBAAgB,CAAC,OAAO,CAAC;oBACvB,OAAO,EAAE,CAAC;4BACR,OAAO,EAAE,SAAS;yBACnB,CAAC;iBACH,CAAC,CAAC;aACJ;YAED,IAAI,IAAA,qCAAmB,EAAC,KAAK,CAAC,EAAE;gBAC9B,gBAAgB,CAAC,IAAI,CAAC,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAG,CAAC,CAAC,CAAC,CAAC;aACzC;iBAAM;gBACL,gBAAgB,CAAC,IAAI,CAAC;oBACpB,OAAO,EAAE,CAAC;4BACR,OAAO,EAAE,WAAW;yBACrB,CAAC;iBACH,CAAC,CAAC;aACJ;YAED,OAAO,CAAC;oBACN,QAAQ,EAAE,gBAAgB;oBAC1B,IAAI,EAAE;wBACJ,QAAQ,EAAE,mBAAmB;qBAC9B;iBACF,CAAC,CAAC;SACJ;QAED,IAAI,WAAW,KAAK,gBAAgB,EAAE;YACpC,uEAAuE;YACvE,mBAAmB,CAAC,IAAI;gBACtB,GAAC,WAAW,IAAG;wBACb,GAAC,WAAW,IAAG,CAAC;gCACd,OAAO,EAAE,GAAG;6BACb,CAAC;4BACF;oBACF,CAAC;SACJ;aAAM,IAAI,WAAW,KAAK,gBAAgB,EAAE;YAC3C,mBAAmB,CAAC,IAAI;gBACtB,GAAC,WAAW,IAAG;wBACb,GAAC,WAAW,IAAG,CAAC;gCACd,OAAO,EAAE,GAAG;6BACb,CAAC;6BACD;wBACD,OAAO,EAAE,CAAC;gCACR,OAAO,EAAE,KAAK;6BACf,CAAC;qBACH,CAAC;gBACF,GAAC,IAAI,IAAG;oBACN,YAAY,EAAE,GAAG;oBACjB,cAAc,EAAE,GAAG;oBACnB,UAAU,EAAE,GAAG;iBAChB;oBACD,CAAC;SACJ;aAAM,IAAI,WAAW,KAAK,mBAAmB,EAAE;YAC9C,gDAAgD;YAChD,IAAM,aAAa,GAAG,gBAA+B,CAAC;YACtD,mBAAmB,CAAC,IAAI;gBACtB,GAAC,WAAW,IAAG;wBACb,GAAC,WAAW,IAAG,CAAC;gCACd,OAAO,EAAE,GAAG;6BACb,CAAC;6BACD;wBACD,aAAa,EAAE,CAAC;gCACd,OAAO,EAAE,CAAC;wCACR,OAAO,EAAE,aAAa,CAAC,CAAC,CAAC;qCAC1B,CAAC;6BACH,CAAC;qBACH,EAAE;wBACD,aAAa,EAAE,CAAC;gCACd,OAAO,EAAE,CAAC;wCACR,OAAO,EAAE,aAAa,CAAC,CAAC,CAAC;qCAC1B,CAAC;6BACH,CAAC;qBACH,CAAC;oBACF,CAAC;SACJ;aAAM;YACL,mBAAmB,CAAC,IAAI;gBACtB,GAAC,WAAW,IAAG;wBACb,GAAC,WAAW,IAAG,CAAC;gCACd,OAAO,EAAE,GAAG;6BACb,CAAC;6BACD;wBACD,OAAO,EAAE,CAAC;gCACR,OAAO,EAAE,KAAK;6BACf,CAAC;qBACH,CAAC;oBACF,CAAC;SACJ;QAGD,OAAO,mBAAmB,CAAC;IAC7B,CAAC;IAED;;;;;OAKG;IACH,+CAAsB,GAAtB,UAAuB,MAAgB;;QAAvC,iBAsBC;QArBC,IAAI,SAAS,GAAU,EAAE,CAAC;QAE1B,IAAI,IAAA,oCAAkB,EAAC,MAAM,CAAC,EAAE;YAC9B,SAAS,GAAG,IAAI,CAAC,0CAA0C,CAAC,MAAM,CAAC,CAAC;SACrE;aAAM,IAAI,IAAA,kCAAgB,EAAC,MAAM,CAAC,EAAE;YACnC,SAAS,CAAC,IAAI,CAAC;gBACb,GAAG,EAAE,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;aAC5C,CAAC,CAAC;SACJ;aAAM,IAAI,IAAA,qCAAmB,EAAC,MAAM,CAAC,EAAE;YAEpC,IAAA,QAAQ,GAEN,MAAM,GAFA,EACL,IAAI,GACL,MAAM,SADD,CACE;YACX,IAAM,YAAY,GAAa,IAAA,qBAAW,EAAC,cAAc,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;YACpF,IAAM,UAAU,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;YACnC,IAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,UAAA,SAAS,IAAI,OAAA,KAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAzC,CAAyC,CAAC,CAAC;YACvF,SAAS,CAAC,IAAI;gBACZ,GAAC,UAAU,IAAG,aAAa;oBAC3B,CAAC;SACJ;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;IAED;;;;;OAKG;IACH,yDAAgC,GAAhC,UAAiC,WAAyB;QAA1D,iBA0CC;QAzCC,IAAM,cAAc,GAAQ,EAAE,CAAC;QAC/B,IAAM,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;QAC3D,IAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACzD,IAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACzD,IAAM,iBAAiB,GAAG,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,CAAC;QAC/D,IAAM,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;QAE7D,WAAW,CAAC,OAAO,CAAC,UAAA,IAAI;YACtB,IAAM,aAAa,GAAQ,EAAE,CAAC;YAC9B,IAAI,OAAc,CAAC;YACnB,QAAQ,IAAI,CAAC,IAAI,EAAE;gBACjB,KAAK,MAAM;oBACT,OAAO,GAAG,KAAI,CAAC,uCAAuC,CAAC,IAAI,CAAC,CAAC;oBAC7D,aAAa,CAAC,eAAe,CAAC,GAAG,OAAO,CAAC;oBACzC,MAAM;gBACR,KAAK,MAAM;oBACT,OAAO,GAAG,KAAI,CAAC,uCAAuC,CAAC,IAAI,CAAC,CAAC;oBAC7D,aAAa,CAAC,eAAe,CAAC,GAAG,OAAO,CAAC;oBACzC,MAAM;gBACR,KAAK,MAAM;oBACT,OAAO,GAAG,KAAI,CAAC,sCAAsC,CAAC,IAAI,CAAC,CAAC;oBAC5D,aAAa,CAAC,cAAc,CAAC,GAAG,OAAO,CAAC;oBACxC,MAAM;gBACR,KAAK,MAAM;oBACT,OAAO,GAAG,KAAI,CAAC,sCAAsC,CAAC,IAAI,CAAC,CAAC;oBAC5D,aAAa,CAAC,cAAc,CAAC,GAAG,OAAO,CAAC;oBACxC,MAAM;gBACR,KAAK,MAAM;oBACT,OAAO,GAAG,KAAI,CAAC,yCAAyC,CAAC,IAAI,CAAC,CAAC;oBAC/D,aAAa,CAAC,iBAAiB,CAAC,GAAG,OAAO,CAAC;oBAC3C,MAAM;gBACR,KAAK,QAAQ;oBACX,OAAO,GAAG,KAAI,CAAC,0CAA0C,CAAC,IAAI,CAAC,CAAC;oBAChE,aAAa,CAAC,gBAAgB,CAAC,GAAG,OAAO,CAAC;oBAC1C,MAAM;gBACR;oBACE,MAAM;aACT;YACD,cAAc,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;;OAKG;IACH,gEAAuC,GAAvC,UAAwC,cAAgC;;QACtE,IAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACvD,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACrD,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAC3C,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAC7C,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAE3C,IAAM,YAAY,GAAG,wBAAwB,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACjF,IAAM,IAAI,GAAU;gBAClB,GAAC,aAAa,IAAG,CAAC;wBAChB,OAAO,EAAE,YAAY,CAAC,CAAC,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,CAAC,cAAc,CAAC,aAAa,CAAC,WAAW,EAAE;qBAClG,CAAC;oBACF,CAAC;QAEH,IAAI,cAAc,CAAC,KAAK,IAAI,cAAc,CAAC,WAAW,EAAE;YACtD,IAAM,iBAAiB,GAAG,EAAE,CAAC;YAC7B,IAAI,cAAc,CAAC,KAAK,EAAE;gBACxB,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,KAAK,CAAC,EAAE;oBAC7C,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,KAAK,CAAC,CAAC;oBACtE,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,MAAM;yBACjB;4BACD,CAAC;iBACJ;qBAAM;oBACL,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,KAAK;6BAC9B,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,MAAM;yBACjB;4BACD,CAAC;iBACJ;aACF;YACD,IAAI,cAAc,CAAC,WAAW,EAAE;gBAC9B,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,WAAW,CAAC,EAAE;oBACnD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,WAAW,CAAC,CAAC;oBAC5E,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,cAAc;yBACzB;4BACD,CAAC;iBACJ;qBAAM;oBACL,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,WAAW;6BACpC,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,cAAc;yBACzB;4BACD,CAAC;iBACJ;aACF;YACD,IAAI,CAAC,IAAI;gBACP,GAAC,IAAI,IAAG,iBAAiB;oBACzB,CAAC;SACJ;QAED,IAAI,cAAc,CAAC,WAAW,IAAI,cAAc,CAAC,WAAW,IAAI,cAAc,CAAC,aAAa,EAAE;YAC5F,IAAM,mBAAmB,GAAG,EAAE,CAAC;YAC/B,IAAI,cAAc,CAAC,WAAW,EAAE;gBAC9B,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,WAAW,CAAC,EAAE;oBACnD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,WAAW,CAAC,CAAC;oBAC5E,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,QAAQ;yBACnB;4BACD,CAAC;iBACJ;qBAAM;oBACL,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,WAAW;6BACpC,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,QAAQ;yBACnB;4BACD,CAAC;iBACJ;aACF;YACD,IAAI,cAAc,CAAC,WAAW,EAAE;gBAC9B,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,WAAW,CAAC,EAAE;oBACnD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,WAAW,CAAC,CAAC;oBAC5E,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,cAAc;yBACzB;4BACD,CAAC;iBACJ;qBAAM;oBACL,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,WAAW;6BACpC,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,cAAc;yBACzB;4BACD,CAAC;iBACJ;aACF;YACD,IAAI,cAAc,CAAC,aAAa,EAAE;gBAChC,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,aAAa,CAAC,EAAE;oBACrD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,aAAa,CAAC,CAAC;oBAC9E,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,gBAAgB;yBAC3B;4BACD,CAAC;iBACJ;qBAAM;oBACL,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,aAAa;6BACtC,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,gBAAgB;yBAC3B;4BACD,CAAC;iBACJ;aACF;YACD,IAAI,CAAC,IAAI;gBACP,GAAC,MAAM,IAAG,mBAAmB;oBAC7B,CAAC;SACJ;QAED,IAAM,OAAO,GAAU;gBACrB,GAAC,IAAI,IAAG,IAAI;oBACZ,CAAC;QAEH,IAAI,cAAc,CAAC,OAAO,EAAE;YAC1B,OAAO,CAAC,IAAI;gBACV,GAAC,OAAO,IAAG,CAAC;wBACV,OAAO,EAAE,cAAc,CAAC,OAAO,CAAC,QAAQ,EAAE;qBAC3C,CAAC;oBACF,CAAC;SACJ;QAED,IAAI,cAAc,CAAC,MAAM,KAAK,SAAS,EAAE;YACvC,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,MAAM,CAAC,EAAE;gBAC9C,OAAO,CAAC,IAAI;oBACV,sDAAsD;oBACtD,GAAC,IAAI,IAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,MAAM,CAAC;wBAC7D,CAAC;aACJ;iBAAM;gBACL,OAAO,CAAC,IAAI;oBACV,GAAC,IAAI,IAAG,CAAC;4BACP,OAAO,EAAE,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE;yBAChD,CAAC;wBACF,CAAC;aACJ;SACF;QAED,IAAI,cAAc,CAAC,MAAM,EAAE;YACzB,OAAO,CAAC,IAAI;gBACV,GAAC,QAAQ,IAAG,CAAC;wBACX,OAAO,EAAE,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE;qBAC1C,CAAC;oBACF,CAAC;SACJ;QAED,OAAO;gBACL,GAAC,OAAO,IAAG,OAAO;oBAClB,CAAC;IACL,CAAC;IAED;;;;;;OAMG;IACH,gEAAuC,GAAvC,UAAwC,cAAgC;;QACtE,IAAM,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;QAC3D,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACzD,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAC3C,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAC7C,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAE3C,IAAM,OAAO,GAAU;gBACrB,GAAC,eAAe,IAAG;wBACjB,GAAC,cAAc,IAAG,EAAE;wBACpB,QAAI,GAAE;4BACJ,cAAc,EAAE,QAAQ;4BACxB,eAAe,EAAE,8BAA8B;4BAC/C,cAAc,EAAE,cAAc,CAAC,KAAK;yBACrC;4BACD;oBACF,CAAC;QAEH,IAAI,OAAO,cAAc,CAAC,KAAK,KAAK,QAAQ,IAAI,cAAc,CAAC,KAAK,YAAY,MAAM,EAAE;YACtF,IAAM,OAAO,GAAG,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;YACtD,QAAQ,OAAO,EAAE;gBACf,KAAK,KAAK,CAAC;gBACX,KAAK,MAAM,CAAC;gBACZ,KAAK,KAAK;oBACR,OAAO,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,gBAAS,OAAO,CAAE,CAAC,CAAC;oBAC9D,MAAM;gBACR,KAAK,KAAK;oBACR,OAAO,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;oBACxD,MAAM;gBACR,KAAK,KAAK;oBACR,OAAO,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;oBAC3D,MAAM;gBACR;oBACE,MAAM;aACT;SACF;QAED,IAAI,cAAc,CAAC,OAAO,EAAE;YAC1B,OAAO,CAAC,IAAI;gBACV,GAAC,OAAO,IAAG,CAAC;wBACV,OAAO,EAAE,cAAc,CAAC,OAAO;qBAChC,CAAC;oBACF,CAAC;SACJ;QACD,IAAI,cAAc,CAAC,IAAI,EAAE;YACvB,OAAO,CAAC,IAAI;gBACV,GAAC,IAAI,IAAG,CAAC;wBACP,OAAO,EAAE,cAAc,CAAC,IAAI;qBAC7B,CAAC;oBACF,CAAC;SACJ;QACD,IAAI,cAAc,CAAC,MAAM,EAAE;YACzB,OAAO,CAAC,IAAI;gBACV,GAAC,QAAQ,IAAG,CAAC;wBACX,OAAO,EAAG,cAAc,CAAC,MAAM;qBAChC,CAAC;oBACF,CAAC;SACJ;QACD,OAAO;gBACL,GAAC,OAAO,IAAG,OAAO;oBAClB,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACH,+DAAsC,GAAtC,UAAuC,cAAgC;;QACrE,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACrD,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACrD,IAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACvD,IAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACvD,IAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACzD,IAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACzD,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAC7C,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAEvC,IAAM,iBAAiB,GAAQ;gBAC7B,GAAC,KAAK,IAAG,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS;oBACpG,CAAC;QAEH,IAAM,eAAe,GAAG;YACtB,IAAI,EAAE,aAAa;YACnB,IAAI,EAAE,WAAW;YACjB,SAAS,EAAE,YAAY;YACvB,UAAU,EAAE,aAAa;SAC1B,CAAC;QAEF,IAAM,iBAAiB,GAAU,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC;aACzD,MAAM,CAAC,UAAC,QAAa,IAAK,OAAA,QAAQ,KAAK,MAAM,IAAI,eAAe,CAAC,QAAQ,CAAC,EAAhD,CAAgD,CAAC;aAC3E,GAAG,CAAC,UAAC,QAAa;;YACjB,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE;gBACjD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC1E;oBACE,GAAC,YAAY,IAAG,QAAQ;oBACxB,QAAI,GAAE;wBACJ,QAAQ,EAAE,eAAe,CAAC,QAAQ,CAAC;qBACpC;uBACD;aACH;iBAAM;gBACL;oBACE,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,QAAQ,KAAK,MAAM;gCAC1B,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCAC7B,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC;yBAC7B,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,eAAe,CAAC,QAAQ,CAAC;qBACpC;uBACD;aACH;QACH,CAAC,CAAC,CAAC;QAEL,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;YAChC,iBAAiB,CAAC,IAAI;gBACpB,GAAC,IAAI,IAAG,iBAAiB;oBACzB,CAAC;SACJ;QAED,IAAI,cAAc,CAAC,MAAM,IAAI,cAAc,CAAC,MAAM,KAAK,SAAS,EAAE;YAChE,IAAM,cAAc,GAAQ,EAAE,CAAC;YAC/B,IAAI,cAAc,CAAC,MAAM,EAAE;gBACzB,cAAc,CAAC,IAAI;oBACjB,GAAC,YAAY,IAAG;4BACd,GAAC,aAAa,IAAG,CAAC;oCAChB,OAAO,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;iCAC7C,CAAC;;4BAEF,GAAC,aAAa,IAAG,CAAC;oCAChB,OAAO,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;iCAC7C,CAAC;gCACF;wBACF,CAAC;aACJ;YACD,IAAI,cAAc,CAAC,MAAM,KAAK,SAAS,EAAE;gBACvC,cAAc,CAAC,IAAI;oBACjB,GAAC,QAAQ,IAAG,CAAC;4BACX,OAAO,EAAE,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE;yBAC1C,CAAC;wBACF,CAAC;aACJ;YACD,iBAAiB,CAAC,IAAI;gBACpB,GAAC,cAAc,IAAG;wBAChB,GAAC,cAAc,IAAG,cAAc;4BAChC;oBACF,CAAC;SACJ;QAED,IAAI,cAAc,CAAC,SAAS,IAAI,cAAc,CAAC,SAAS,EAAE;YACxD,IAAM,IAAI,GAAQ,EAAE,CAAC;YACrB,IAAM,oBAAoB,GAAG,EAAE,CAAC;YAChC,IAAI,cAAc,CAAC,SAAS,EAAE;gBAC5B,IAAI,CAAC,IAAI;oBACP,GAAC,MAAM,IAAG,CAAC;4BACT,OAAO,EAAE,cAAc,CAAC,SAAS,CAAC,QAAQ,EAAE;yBAC7C,CAAC;wBACF,CAAC;aACJ;YACD,IAAI,cAAc,CAAC,SAAS,EAAE;gBAC5B,oBAAoB,CAAC,IAAI;oBACvB,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,cAAc,CAAC,SAAS;yBAClC,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,MAAM;qBACjB;wBACD,CAAC;aACJ;YACD,IAAI,cAAc,CAAC,WAAW,EAAE;gBAC9B,oBAAoB,CAAC,IAAI;oBACvB,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,cAAc,CAAC,WAAW;yBACpC,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,cAAc;qBACzB;wBACD,CAAC;aACJ;YACD,IAAI,oBAAoB,CAAC,MAAM,GAAG,CAAC,EAAE;gBACnC,IAAI,CAAC,IAAI;oBACP,GAAC,IAAI,IAAG,oBAAoB;wBAC5B,CAAC;aACJ;YACD,iBAAiB,CAAC,IAAI;gBACpB,GAAC,IAAI,IAAG,IAAI;oBACZ,CAAC;SACJ;QACD,IAAI,cAAc,CAAC,KAAK,IAAI,cAAc,CAAC,OAAO,EAAE;YAClD,IAAM,IAAI,GAAG;oBACX,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,cAAc,CAAC,KAAK,IAAI,SAAS;yBAC3C,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,MAAM;qBACjB;;oBAGD,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,cAAc,CAAC,OAAO,IAAI,GAAG;yBACvC,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,cAAc;qBACzB;wBACD,CAAC;YACH,iBAAiB,CAAC,IAAI;gBACpB,GAAC,IAAI,IAAG,IAAI;oBACZ,CAAC;SACJ;QAED,OAAO,iBAAiB,CAAC;IAC3B,CAAC;IAgGD;;;;;OAKG;IACH,+DAAsC,GAAtC,UAAuC,cAAgC;;;QACrE,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACrD,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACvD,IAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;QACnD,IAAM,mBAAmB,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,CAAC;QAEnE,IAAM,WAAW,GAAG;YAClB,KAAK,EAAE,QAAQ;YACf,KAAK,EAAE,cAAc;YACrB,OAAO,EAAE,gBAAgB;YACzB,IAAI,EAAE,iBAAiB;YACvB,GAAG,EAAE,gBAAgB;YACrB,SAAS,EAAE,kBAAkB;YAC7B,UAAU,EAAE,mBAAmB;SAChC,CAAC;QAEF,IAAM,iBAAiB,GAAQ,EAAE,CAAC;QAElC,IAAM,aAAa,GAAU,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC;aACrD,MAAM,CAAC,UAAC,QAAa,IAAK,OAAA,QAAQ,KAAK,MAAM,IAAI,WAAW,CAAC,QAAQ,CAAC;YACnE,cAAc,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,cAAc,CAAC,QAAQ,CAAC,KAAK,IAAI,EADpD,CACoD,CAAC;aAC/E,GAAG,CAAC,UAAC,QAAa;;YACjB,IAAI,KAAK,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC;YACrC,IAAI,QAAQ,KAAK,WAAW,EAAE;gBAC5B,KAAK,GAAG,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBAElF;oBACE,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,KAAK;yBACf,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,WAAW,CAAC,QAAQ,CAAC;qBAChC;uBACD;aACH;YACD,yFAAyF;YACzF,IAAI,QAAQ,KAAK,MAAM,IAAI,KAAK,KAAK,OAAO,EAAE;gBAC5C,KAAK,GAAG,OAAO,CAAC;aACjB;YAED,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE;gBACjD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC1E;oBACE,GAAC,YAAY,IAAG,QAAQ;oBACxB,QAAI,GAAE;wBACJ,QAAQ,EAAE,WAAW,CAAC,QAAQ,CAAC;qBAChC;uBACD;aACH;iBAAM;gBACL;oBACE,GAAC,YAAY,IAAG,CAAC;4BACf,OAAO,EAAE,cAAc,CAAC,QAAQ,CAAC;yBAClC,CAAC;oBACF,QAAI,GAAE;wBACJ,QAAQ,EAAE,WAAW,CAAC,QAAQ,CAAC;qBAChC;uBACD;aACH;QAEH,CAAC,CAAC,CAAC;QAEL,IAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,aAAa,EAAE;YACjC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAG,CAAC,CAAC,0CAAG,MAAM,CAAC,CAAC,EAAE;gBACpD,iBAAiB,CAAC,CAAC,CAAC,aAAK,GAAC,MAAM,IAAG,EAAE,KAAE,CAAC;aACzC;YACD,IAAI,CAAA,MAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,aAAa,0CAAE,IAAI,MAAK,MAAM,EAAE;gBAClD,IAAM,aAAa,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;gBACjG,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI;oBAC/B,GAAC,aAAa,IAAG,aAAa;wBAC9B,CAAC;aACJ;iBAAM,IAAI,CAAA,MAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,aAAa,0CAAE,IAAI,MAAK,MAAM,EAAE;gBACzD,IAAM,aAAa,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;gBACjG,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI;oBAC/B,GAAC,aAAa,IAAG,aAAa;wBAC9B,CAAC;aACJ;SACF;QAED,IAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,EAAE;YAC/B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAG,CAAC,CAAC,0CAAG,MAAM,CAAC,CAAC,EAAE;gBACpD,iBAAiB,CAAC,CAAC,CAAC,aAAK,GAAC,MAAM,IAAG,EAAE,KAAE,CAAC;aACzC;YACD,IAAI,CAAA,MAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,0CAAE,IAAI,MAAK,MAAM,EAAE;gBAChD,IAAM,WAAW,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;gBAC7F,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI;oBAC/B,GAAC,WAAW,IAAG,WAAW;wBAC1B,CAAC;aACJ;iBAAM,IAAI,CAAA,MAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,0CAAE,IAAI,MAAK,MAAM,EAAE;gBACvD,IAAM,WAAW,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;gBAC7F,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI;oBAC/B,GAAC,WAAW,IAAG,WAAW;wBAC1B,CAAC;aACJ;SACF;QAED,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE;YAC9B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAG,CAAC,CAAC,0CAAG,MAAM,CAAC,CAAC,EAAE;gBACpD,iBAAiB,CAAC,CAAC,CAAC,aAAK,GAAC,MAAM,IAAG,EAAE,KAAE,CAAC;aACzC;YACD,CAAA,KAAA,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAA,CAAC,IAAI,WAAI,aAAa,EAAE;SACrD;QACD,IAAI,cAAc,CAAC,mBAAmB,EAAE;YACtC,iBAAiB,CAAC,IAAI;gBACpB,GAAC,mBAAmB,IAAG;oBACrB;wBACE,OAAO,EAAE,cAAc,CAAC,mBAAmB;qBAC5C;iBACF;oBACD,CAAC;SACJ;QAED,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC,EAAE;YAClC,iBAAiB,CAAC,IAAI;gBACpB,GAAC,MAAM,IAAG,EAAE;oBACZ,CAAC;SACJ;QAED,OAAO,iBAAiB,CAAC;IAC3B,CAAC;IAED;;;;;OAKG;IACH,kEAAyC,GAAzC,UAA0C,cAAgC;;;QACxE,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACrD,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACzC,IAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACrC,IAAM,iBAAiB,GAAG;YACxB,YAAY,EAAE,QAAQ;YACtB,YAAY,EAAE,cAAc;YAC5B,cAAc,EAAE,gBAAgB;YAChC,gBAAgB,EAAE,kBAAkB;YACpC,UAAU,EAAE,gBAAgB;YAC5B,WAAW,EAAE,iBAAiB;SAC/B,CAAC;QACF,IAAM,eAAe,GAAG;YACtB,KAAK,EAAE,MAAM;YACb,WAAW,EAAE,cAAc;SAC5B,CAAC;QACF,IAAM,mBAAmB,GAAU,EAAE,CAAC;QACtC,IAAM,iBAAiB,GAAU,EAAE,CAAC;QACpC,IAAI,WAAgB,CAAC;QAErB,IAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,EAAE;YAC/B,IAAI,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,CAAC,IAAI,MAAK,MAAM,EAAE;gBAC/C,WAAW,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;aACxF;iBAAM,IAAI,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,WAAW,CAAC,IAAI,MAAK,MAAM,EAAE;gBACtD,WAAW,GAAG,IAAI,CAAC,uCAAuC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;aACxF;SACF;QAED,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC;aACxB,MAAM,CAAC,UAAC,QAAa,IAAK,OAAA,QAAQ,KAAK,MAAM,EAAnB,CAAmB,CAAC;aAC9C,MAAM,CAAC,UAAC,QAAa,IAAK,OAAA,cAAc,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,cAAc,CAAC,QAAQ,CAAC,KAAK,IAAI,EAA3E,CAA2E,CAAC;aACtG,OAAO,CAAC,UAAC,QAAa;;YACrB,IAAI,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;gBACnD,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE;oBACjD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAC1E,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,eAAe,CAAC,QAAQ,CAAC;yBACpC;4BACD,CAAC;iBACJ;qBAAM;oBACL,iBAAiB,CAAC,IAAI;wBACpB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,cAAc,CAAC,QAAQ,CAAC;6BAClC,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,eAAe,CAAC,QAAQ,CAAC;yBACpC;4BACD,CAAC;iBACJ;aACF;iBAAM,IAAI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;gBAE5D,IAAI,kBAAgB,GAAW,EAAE,CAAC;gBAElC,IAAI,QAAQ,KAAK,kBAAkB,EAAE;oBACnC,IAAM,YAAU,GAAa,cAAc,CAAC,QAAQ,CAAC,CAAC;oBACtD,kBAAgB,GAAG,EAAE,CAAC;oBACtB,YAAU,CAAC,OAAO,CAAC,UAAC,IAAY,EAAE,GAAG;wBACnC,kBAAgB,IAAI,IAAI,CAAC;wBACzB,IAAI,GAAG,GAAG,YAAU,CAAC,MAAM,GAAG,CAAC,EAAE;4BAC/B,kBAAgB,IAAI,GAAG,CAAC;yBACzB;oBACH,CAAC,CAAC,CAAC;iBACJ;qBAAM,IAAI,QAAQ,KAAK,cAAc,EAAE;oBACtC,kBAAgB,GAAG,cAAc,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;iBAClD;qBAAO,IAAI,QAAQ,KAAK,gBAAgB,EAAE;oBACzC,kBAAgB,GAAG,cAAc,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;iBAClD;qBAAM;oBACL,kBAAgB,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC;iBAC7C;gBAED,IAAI,IAAA,qCAAmB,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE;oBACjD,IAAM,QAAQ,GAAG,IAAA,wCAA8B,EAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAC1E,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,QAAQ;wBACxB,QAAI,GAAE;4BACJ,QAAQ,EAAE,iBAAiB,CAAC,QAAQ,CAAC;yBACtC;4BACD,CAAC;iBACJ;qBAAM;oBACL,mBAAmB,CAAC,IAAI;wBACtB,GAAC,YAAY,IAAG,CAAC;gCACf,OAAO,EAAE,kBAAgB;6BAC1B,CAAC;wBACF,QAAI,GAAE;4BACJ,QAAQ,EAAE,iBAAiB,CAAC,QAAQ,CAAC;yBACtC;4BACD,CAAC;iBACJ;aAEF;QACH,CAAC,CAAC,CAAC;QAEL,IAAM,iBAAiB,GAAQ,EAAE,CAAC;QAClC,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,IAAI,WAAW,EAAE;YAC/C,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAG,CAAC,CAAC,0CAAG,IAAI,CAAC,CAAC,EAAE;gBAClD,iBAAiB,CAAC,CAAC,CAAC,aAAK,GAAC,IAAI,IAAG,EAAE,KAAE,CAAC;aACvC;YACD,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;gBAChC,CAAA,KAAA,iBAAiB,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA,CAAC,IAAI,WAAI,iBAAiB,EAAE;aACvD;YACD,IAAI,WAAW,EAAE;gBACf,iBAAiB,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;oBAC9B,WAAW,EAAE,WAAW;iBACzB,CAAC,CAAC;aACJ;SACF;QAED,IAAI,mBAAmB,CAAC,MAAM,GAAG,CAAC,EAAE;YAClC,iBAAiB,CAAC,IAAI;gBACpB,GAAC,MAAM,IAAG,mBAAmB;oBAC7B,CAAC;SACJ;QAED,OAAO,iBAAiB,CAAC;IAC3B,CAAC;IAED;;;;;OAKG;IACH,mEAA0C,GAA1C,UAA2C,gBAAoC;QAC7E,IAAM,mBAAmB,GAAQ,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,gBAAgB,CAAC,OAAO,KAAK,SAAS,EAAE;YAC1C,mBAAmB,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,CAAC;oBAChC,OAAO,EAAE,gBAAgB,CAAC,OAAO;iBAClC,CAAC,CAAC;SACJ;QAED,IAAI,QAAa,CAAC;QAClB,IAAI,gBAAgB,CAAC,QAAQ,EAAE;YAC7B,QAAQ,GAAG,IAAI,CAAC,0BAA0B,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;YACtE,IAAI,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAC,EAAE;gBACjB,mBAAmB,CAAC,IAAI,CAAC;oBACvB,QAAQ,EAAE,QAAQ;iBACnB,CAAC,CAAC;aACJ;SACF;QAED,IAAI,gBAAqB,CAAC;QAC1B,IAAI,gBAAgB,CAAC,gBAAgB,EAAE;YACrC,gBAAgB,GAAG,IAAI,CAAC,0CAA0C,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC;YACtG,IAAI,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAG,CAAC,CAAC,EAAE;gBACzB,mBAAmB,CAAC,IAAI,CAAC;oBACvB,gBAAgB,EAAE,gBAAgB;iBACnC,CAAC,CAAC;aACJ;SACF;QAED,IAAI,mBAAwB,CAAC;QAC7B,IAAI,gBAAgB,CAAC,mBAAmB,EAAE;YACxC,mBAAmB,GAAG,IAAI,CAAC,gDAAgD,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,CAAC;YAClH,IAAI,mBAAmB,aAAnB,mBAAmB,uBAAnB,mBAAmB,CAAG,CAAC,CAAC,EAAE;gBAC5B,mBAAmB,CAAC,IAAI,CAAC;oBACvB,mBAAmB,EAAE,mBAAmB;iBACzC,CAAC,CAAC;aACJ;SACF;QAED,OAAO,mBAAmB,CAAC;IAC7B,CAAC;IAED;;;;;OAKG;IACH,mDAA0B,GAA1B,UAA2B,QAAkB;QAC3C,IAAM,WAAW,GAAU,EAAE,CAAC;QAC9B,sBAAsB;QACtB,IAAI,QAAQ,CAAC,IAAI,EAAE;YACjB,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;YAC3B,WAAW,CAAC,IAAI,CAAC,GAAG;gBAClB,QAAQ,EAAE,IAAI;aACf,CAAC;SACH;QACD,0BAA0B;QAC1B,IAAI,QAAQ,CAAC,QAAQ,KAAK,SAAS,EAAE;YACnC,IAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;YAC9C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;gBACtB,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;aACxB;YACD,WAAW,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,GAAG,QAAQ,CAAC;SAC5C;QACD,iCAAiC;QACjC,IAAI,QAAQ,CAAC,eAAe,IAAI,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;YACnE,IAAM,eAAe,GAAU,QAAQ,CAAC,eAAe,CAAC,GAAG,CAAC,UAAC,KAAoB;gBAC/E,IAAM,MAAM,GAAQ;oBAClB,aAAa,EAAE,EAAE;oBACjB,IAAI,EAAE,EAAE;iBACT,CAAC;gBACF,IAAI,KAAK,CAAC,KAAK,EAAE;oBACf,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC;iBACvC;gBACD,IAAI,OAAO,KAAK,CAAC,QAAQ,KAAK,WAAW,EAAE;oBACzC,MAAM,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;iBACxD;gBACD,IAAI,KAAK,CAAC,KAAK,EAAE;oBACf,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC;iBACvC;gBACD,IAAI,OAAO,KAAK,CAAC,OAAO,KAAK,WAAW,EAAE;oBACxC,MAAM,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;iBACtD;gBACD,OAAO,MAAM,CAAC;gBAChB,+BAA+B;YAC/B,CAAC,CAAC,CAAC,MAAM,CAAC,UAAC,KAAU,IAAK,OAAA,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,CAAC,EAA7B,CAA6B,CAAC,CAAC;YACzD,WAAW,CAAC,IAAI,OAAhB,WAAW,EAAS,eAAe,EAAE;SACtC;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;IAED;;;;;OAKG;IACH,mEAA0C,GAA1C,UAA2C,gBAAkC;QAA7E,iBAoCC;QAnCC,IAAM,WAAW,GAAG;YAClB,UAAU,EAAE,YAAY;YACxB,WAAW,EAAE,aAAa;YAC1B,YAAY,EAAE,cAAc;YAC5B,WAAW,EAAE,aAAa;SAC3B,CAAC;QACF,IAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC3C,IAAM,mBAAmB,GAAU,EAAE,CAAC;QACtC,IAAI,CAAC,OAAO,CAAC,UAAC,GAAW;;;YACvB,IAAM,OAAO,GAAQ,EAAE,CAAC;YACxB,0BAA0B;YAC1B,IAAM,iBAAiB,GAAG,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAG,GAAG,CAAC,0CAAE,iBAAiB,CAAC;YACrE,IAAM,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;YACrC,4BAA4B;YAC5B,IAAM,mBAAmB,GAAG,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAG,GAAG,CAAC,0CAAE,mBAAmB,CAAC;YACzE,IAAI,iBAAiB,IAAI,mBAAmB,EAAE;gBAC5C,IAAI,iBAAiB,EAAE;oBACrB,OAAO,CAAC,IAAI,CAAC;wBACX,iBAAiB,EAAE,CAAC;gCAClB,OAAO,EAAE,iBAAiB;6BAC3B,CAAC;qBACH,CAAC,CAAC;iBACJ;gBACD,IAAI,mBAAmB,EAAE;oBACvB,OAAO,CAAC,IAAI,CAAC;wBACX,mBAAmB,EAAE,KAAI,CAAC,gDAAgD,CAAC,mBAAmB,CAAC;qBAChG,CAAC,CAAC;iBACJ;gBACD,mBAAmB,CAAC,IAAI;oBACtB,GAAC,WAAW,IAAG,OAAO;wBACtB,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;QAEH,OAAO,mBAAmB,CAAC;IAC7B,CAAC;IAED;;;;;SAKK;IACL,yEAAgD,GAAhD,UAAiD,mBAAwC;QACvF,IAAM,sBAAsB,GAAQ,EAAE,CAAC;QACvC,IAAM,eAAe,GAAG,mBAAmB,aAAnB,mBAAmB,uBAAnB,mBAAmB,CAAE,eAAe,CAAC;QAC7D,IAAI,eAAe,KAAK,WAAW,EAAE;YACnC,kBAAkB;YAClB,sBAAsB,CAAC,IAAI,CAAC;gBAC1B,SAAS,EAAE,EAAE;aACd,CAAC,CAAC;SACJ;aAAM,IAAI,eAAe,KAAK,WAAW,EAAE;YAC1C,kBAAkB;YAClB,sBAAsB,CAAC,IAAI,CAAC;gBAC1B,SAAS,EAAE,EAAE;aACd,CAAC,CAAC;SACJ;QACD,mBAAmB;QACnB,IAAI,mBAAmB,CAAC,UAAU,KAAK,SAAS,EAAE;YAChD,sBAAsB,CAAC,IAAI,CAAC;gBAC1B,UAAU,EAAE,CAAC;wBACX,OAAO,EAAE,mBAAmB,CAAC,UAAU;qBACxC,CAAC;aACH,CAAC,CAAC;SACJ;QACD,OAAO,sBAAsB,CAAC;IAChC,CAAC;IAED,sDAA6B,GAA7B,UAA8B,cAAqB;QAAnD,iBAkCC;QAjCC,IAAM,qBAAqB,GAAG,UAAC,CAAS,IAAK,OAAA,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAA/B,CAA+B,CAAC;QAC7E,IAAM,qBAAqB,GAA0B,EAAE,CAAC;QACxD,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI;YAC/B,yFAAyF;YACzF,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,UAAU;;gBACjC,IAAM,GAAG,GAAG,qBAAqB,CAAC,UAAG,UAAU,CAAC,IAAI,eAAY,CAAC,CAAC;gBAClE,IAAM,KAAK,GAAG,MAAA,MAAA,KAAI,CAAC,qBAAqB,0CAAE,UAAU,0CAAG,GAAG,CAAC,CAAC;gBAC5D,IAAI,KAAK,EAAE;oBACT,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,YAAY,MAAM,EAAE;wBACxD,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE;4BACrC,qBAAqB,CAAC,UAAU,GAAG,EAAE,CAAC;yBACvC;wBACD,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;qBAC/C;yBAAM;wBACL,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,UAAA,QAAQ;4BACtC,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE;gCACnB,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE;oCACrC,qBAAqB,CAAC,UAAU,GAAG,EAAE,CAAC;iCACvC;gCACD,IAAI,CAAC,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;oCAC1C,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;iCAC5C;gCACD,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC;6BACnE;wBACH,CAAC,CAAC,CAAC;qBACJ;iBACF;YACH,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,IAAI,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;YACjD,OAAO,qBAAqB,CAAC;SAC9B;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;IAlzED;;OAEG;IACW,oBAAK,GAAG,kBAAkB,CAAC;IAiElC,kCAAmB,GAAG;QAC3B,GAAG,EAAE,GAAG;KACT,CAAC;IACK,6BAAc,GAAG;QACtB,GAAG,EAAE,IAAI;QACT,EAAE,EAAE,IAAI;QACR,iBAAiB,EAAE,IAAI;KACxB,CAAC;IACK,4BAAa,GAAG;QACrB,iBAAiB,EAAE,IAAI;QACvB,oBAAoB,EAAE,IAAI;QAC1B,cAAc,EAAE,IAAI;QACpB,kBAAkB,EAAE,GAAG;QACvB,2BAA2B,EAAE,IAAI;QACjC,qBAAqB,EAAE,GAAG;QAC1B,8BAA8B,EAAE,IAAI;QACpC,cAAc,EAAE,IAAI;QACpB,iBAAiB,EAAE,OAAO;KAC3B,CAAC;IA8tEJ,qBAAC;CAAA,AAtzED,IAszEC;AAtzEY,wCAAc;AAwzE3B,kBAAe,cAAc,CAAC","sourcesContent":["import {\n  Channel,\n  ChannelSelection,\n  ColorMap,\n  ColorMapEntry,\n  ColorMapType,\n  CombinationOperator,\n  ComparisonFilter,\n  ComparisonOperator,\n  ContrastEnhancement,\n  Expression,\n  FillSymbolizer as GsFillSymbolizer,\n  Filter as GsFilter,\n  IconSymbolizer as GsIconSymbolizer,\n  isCombinationFilter,\n  isComparisonFilter,\n  isGeoStylerFunction,\n  isGeoStylerNumberFunction,\n  isNegationFilter,\n  LineSymbolizer as GsLineSymbolizer,\n  MarkSymbolizer as GsMarkSymbolizer,\n  PointSymbolizer as GsPointSymbolizer,\n  RangeFilter,\n  RasterSymbolizer as GsRasterSymbolizer,\n  ReadStyleResult,\n  Rule as GsRule,\n  ScaleDenominator,\n  StyleParser,\n  Symbolizer,\n  TextSymbolizer as GsTextSymbolizer,\n  UnsupportedProperties,\n  WellKnownName as GsWellKnownName,\n  WriteStyleResult\n} from 'geostyler-style';\nimport {\n  Style\n} from 'geostyler-style';\nimport {\n  XMLBuilder,\n  XMLParser,\n  X2jOptionsOptional,\n  XmlBuilderOptionsOptional\n} from 'fast-xml-parser';\n\nimport {\n  geoStylerFunctionToSldFunction,\n  get,\n  getAttribute,\n  getChildren,\n  getParameterValue,\n  isSymbolizer,\n  keysByValue,\n  numberExpression\n} from './Util/SldUtil';\n\nexport type SldVersion = '1.0.0' | '1.1.0';\n\nexport type ConstructorParams = {\n  numericFilterFields?: string[];\n  boolFilterFields?: string[];\n  sldVersion?: SldVersion;\n  symbolizerUnits?: string;\n  parserOptions?: X2jOptionsOptional;\n  builderOptions?: XmlBuilderOptionsOptional;\n};\n\nconst WELLKNOWNNAME_TTF_REGEXP = /^ttf:\\/\\/(.+)#(.+)$/;\n\n/**\n * This parser can be used with the GeoStyler.\n * It implements the geostyler-style StyleParser interface.\n *\n * @class SldStyleParser\n * @implements StyleParser\n */\nexport class SldStyleParser implements StyleParser<string> {\n\n  /**\n   * The name of the SLD Style Parser.\n   */\n  public static title = 'SLD Style Parser';\n\n  title = 'SLD Style Parser';\n\n  unsupportedProperties: UnsupportedProperties = {\n    Symbolizer: {\n      MarkSymbolizer: {\n        avoidEdges: 'none',\n        blur: 'none',\n        offset: 'none',\n        offsetAnchor: 'none',\n        pitchAlignment: 'none',\n        pitchScale: 'none',\n        visibility: 'none'\n      },\n      FillSymbolizer: {\n        antialias: 'none',\n        opacity: {\n          support: 'none',\n          info: 'General opacity is not supported. Use fillOpacity and strokeOpacity instead.'\n        },\n        visibility: 'none'\n      },\n      IconSymbolizer: {\n        allowOverlap: 'none',\n        anchor: 'none',\n        avoidEdges: 'none',\n        color: 'none',\n        haloBlur: 'none',\n        haloColor: 'none',\n        haloOpacity: 'none',\n        haloWidth: 'none',\n        keepUpright: 'none',\n        offset: 'none',\n        offsetAnchor: 'none',\n        optional: 'none',\n        padding: 'none',\n        pitchAlignment: 'none',\n        rotationAlignment: 'none',\n        textFit: 'none',\n        textFitPadding: 'none',\n        visibility: 'none'\n      },\n      LineSymbolizer: {\n        blur: 'none',\n        gapWidth: 'none',\n        gradient: 'none',\n        miterLimit: 'none',\n        roundLimit: 'none',\n        spacing: 'none',\n        visibility: 'none'\n      },\n      RasterSymbolizer: {\n        brightnessMax: 'none',\n        brightnessMin: 'none',\n        contrast: 'none',\n        fadeDuration: 'none',\n        hueRotate: 'none',\n        resampling: 'none',\n        saturation: 'none',\n        visibility: 'none'\n      }\n    }\n  };\n\n  static negationOperatorMap = {\n    Not: '!'\n  };\n  static combinationMap = {\n    And: '&&',\n    Or: '||',\n    PropertyIsBetween: '&&'\n  };\n  static comparisonMap = {\n    PropertyIsEqualTo: '==',\n    PropertyIsNotEqualTo: '!=',\n    PropertyIsLike: '*=',\n    PropertyIsLessThan: '<',\n    PropertyIsLessThanOrEqualTo: '<=',\n    PropertyIsGreaterThan: '>',\n    PropertyIsGreaterThanOrEqualTo: '>=',\n    PropertyIsNull: '==',\n    PropertyIsBetween: '<=x<='\n  };\n\n  constructor(opts?: ConstructorParams) {\n    this.parser = new XMLParser({\n      ...opts?.parserOptions,\n      // Fixed attributes\n      cdataPropName: '#cdata',\n      ignoreDeclaration: true,\n      removeNSPrefix: true,\n      ignoreAttributes: false,\n      preserveOrder: true\n    });\n    this.builder = new XMLBuilder({\n      ...opts?.builderOptions,\n      // Fixed attributes\n      cdataPropName: '#cdata',\n      ignoreAttributes : false,\n      suppressEmptyNode: true,\n      preserveOrder: true\n    });\n    if (opts?.sldVersion) {\n      this.sldVersion = opts?.sldVersion;\n    }\n    Object.assign(this, opts);\n  }\n\n  private _parser: XMLParser;\n  get parser(): XMLParser {\n    return this._parser;\n  }\n  set parser(parser: XMLParser) {\n    this._parser = parser;\n  }\n\n  private _builder: XMLBuilder;\n  get builder(): XMLBuilder {\n    return this._builder;\n  }\n  set builder(builder: XMLBuilder) {\n    this._builder = builder;\n  }\n\n  /**\n   * Array of field / property names in a filter, which are casted to numerics\n   * while parsing a SLD.\n   */\n  private _numericFilterFields: string[] = [];\n  /**\n   * Getter for _numericFilterFields\n   * @return The numericFilterFields\n   */\n  get numericFilterFields(): string[] {\n    return this._numericFilterFields;\n  }\n  /**\n   * Setter for _numericFilterFields\n   * @param numericFilterFields The numericFilterFields to set\n   */\n  set numericFilterFields(numericFilterFields: string[]) {\n    this._numericFilterFields = numericFilterFields;\n  }\n\n  /**\n   * Array of field / property names in a filter, which are casted to boolean\n   * while parsing a SLD.\n   */\n  private _boolFilterFields: string[] = [];\n  /**\n   * Getter for _boolFilterFields\n   * @return The boolFilterFields\n   */\n  get boolFilterFields(): string[] {\n    return this._boolFilterFields;\n  }\n  /**\n   * Setter for _boolFilterFields\n   * @param boolFilterFields The boolFilterFields to set\n   */\n  set boolFilterFields(boolFilterFields: string[]) {\n    this._boolFilterFields = boolFilterFields;\n  }\n\n  /**\n   * String indicating the SLD version to use. 1.1.0 will make use of\n   * Symbology Encoding. Default ist to use SLD 1.0.0\n   */\n  private _sldVersion: SldVersion = '1.0.0';\n\n  /**\n   * Getter for _sldVersion\n   * @return\n   */\n  get sldVersion(): SldVersion {\n    return this._sldVersion;\n  }\n\n  /**\n   * Setter for _sldVersion\n   * @param sldVersion The _sldVersion value to set\n   */\n  set sldVersion(sldVersion: SldVersion) {\n    this._sldVersion = sldVersion;\n  }\n\n  /**\n   * Used to add a `uom` attribute to the symbolizer tag. Can be one of\n   * `metre`, `foot` or `pixel`. Defaults to pixel.\n   */\n  private _symbolizerUnits: string = 'pixel';\n\n  /**\n   * Getter for _symbolizerUnits\n   * @return {string}\n   */\n  get symbolizerUnits(): string {\n    return this._symbolizerUnits;\n  }\n\n  /**\n   * Setter for _symbolizerUnits\n   * @param {string} symbolizerUnits The _symbolizerUnits value to set\n   */\n  set symbolizerUnits(symbolizerUnits: string) {\n    this._symbolizerUnits = symbolizerUnits;\n  }\n\n  /**\n   * The readStyle implementation of the geostyler-style StyleParser interface.\n   * It reads a SLD as a string and returns a Promise.\n   * The Promise itself resolves with an object containing the geostyler-style.\n   *\n   * @param sldString A SLD as a string.\n   * @return The Promise resolving with an object containing the geostyler-style.\n   */\n  readStyle(sldString: string): Promise<ReadStyleResult> {\n    return new Promise<ReadStyleResult>((resolve) => {\n      try {\n        const sldObject = this.parser.parse(sldString);\n        const geoStylerStyle: Style = this.sldObjectToGeoStylerStyle(sldObject);\n        resolve({\n          output: geoStylerStyle\n        });\n      } catch (error) {\n        resolve({\n          errors: [error]\n        });\n      }\n    });\n  }\n\n  /**\n   * Get the geostyler-style from a SLD Object (created with fast-xml-parser).\n   *\n   * @param sldObject The SLD object representation (created with fast-xml-parser)\n   * @return The geostyler-style\n   */\n  sldObjectToGeoStylerStyle(sldObject: any): Style {\n    const rules = this.getRulesFromSldObject(sldObject);\n    const name = this.getStyleNameFromSldObject(sldObject);\n    return {\n      name,\n      rules\n    };\n  }\n\n  /**\n   * Get the geostyler-style rules from a SLD Object (created with fast-xml-parser).\n   *\n   * @param sldObject The SLD object representation (created with fast-xml-parser)\n   * @return The geostyler-style rules\n   */\n  getRulesFromSldObject(sldObject: any): GsRule[] {\n    const layers = getChildren(sldObject[0].StyledLayerDescriptor, 'NamedLayer');\n    const rules: GsRule[] = [];\n    layers.forEach(({NamedLayer: layer}: any) => {\n      getChildren(layer, 'UserStyle').forEach(({UserStyle: userStyle}: any) => {\n        getChildren(userStyle, 'FeatureTypeStyle').forEach(({FeatureTypeStyle: featureTypeStyle}: any) => {\n          getChildren(featureTypeStyle, 'Rule').forEach(({Rule: sldRule}: any) => {\n            const filter: GsFilter | undefined = this.getFilterFromRule(sldRule);\n            const scaleDenominator: ScaleDenominator | undefined = this.getScaleDenominatorFromRule(sldRule);\n            const symbolizers: Symbolizer[] = this.getSymbolizersFromRule(sldRule);\n            const ruleTitle = get(sldRule, 'Title.#text');\n            const ruleName = get(sldRule, 'Name.#text');\n            const name = ruleTitle !== undefined\n              ? ruleTitle\n              : (ruleName !== undefined ? ruleName : '');\n            const rule: GsRule = <GsRule> {\n              name\n            };\n            if (filter) {\n              rule.filter = filter;\n            }\n            if (scaleDenominator) {\n              rule.scaleDenominator = scaleDenominator;\n            }\n            if (symbolizers) {\n              rule.symbolizers = symbolizers;\n            }\n            rules.push(rule);\n          });\n        });\n      });\n    });\n    return rules;\n  }\n\n  /**\n   * Get the name for the Style from the SLD Object. Returns the Title of the UserStyle\n   * if defined or the Name of the NamedLayer if defined or an empty string.\n   *\n   * @param sldObject The SLD object representation (created with fast-xml-parser)\n   * @return The name to be used for the GeoStyler Style Style\n   */\n  getStyleNameFromSldObject(sldObject: any): string {\n    const userStyleTitle = get(sldObject, 'StyledLayerDescriptor.NamedLayer[0].UserStyle.Title.#text');\n    const namedLayerName = get(sldObject, 'StyledLayerDescriptor.NamedLayer.Name.#text');\n    return userStyleTitle ? userStyleTitle\n      : namedLayerName ? namedLayerName : '';\n  }\n\n  /**\n   * Get the geostyler-style Filter from a SLD Rule.\n   *\n   * Currently only supports one Filter per Rule.\n   *\n   * @param sldRule The SLD Rule\n   * @return The geostyler-style Filter\n   */\n  getFilterFromRule(sldRule: any[]): GsFilter | undefined {\n    const sldFilter = get(sldRule, 'Filter');\n    if (!sldFilter || sldFilter.length === 0) {\n      return;\n    }\n    const operator = Object.keys(sldFilter[0])?.[0];\n    if (!operator) {\n      return;\n    }\n    const filter = this.getFilterFromOperatorAndComparison(operator, sldFilter);\n    return filter;\n  }\n\n  /**\n   * Get the geostyler-style ScaleDenominator from a SLD Rule.\n   *\n   * @param sldRule The SLD Rule\n   * @return The geostyler-style ScaleDenominator\n   */\n  getScaleDenominatorFromRule(sldRule: any[]): ScaleDenominator | undefined {\n    const scaleDenominator: ScaleDenominator = <ScaleDenominator> {};\n    const min = get(sldRule, 'MinScaleDenominator.#text');\n    if (min) {\n      scaleDenominator.min = Number(min);\n    }\n    const max = get(sldRule, 'MaxScaleDenominator.#text');\n    if (max) {\n      scaleDenominator.max = Number(max);\n    }\n\n    return (scaleDenominator.min || scaleDenominator.max)\n      ? scaleDenominator\n      : undefined;\n  }\n\n  /**\n   * Get the geostyler-style Symbolizers from a SLD Rule.\n   *\n   * @param sldRule The SLD Rule\n   * @return The geostyler-style Symbolizer array\n   */\n  getSymbolizersFromRule(sldRule: any[]): Symbolizer[] {\n    const symbolizers: Symbolizer[] = sldRule\n      .filter(isSymbolizer)\n      .map((sldSymbolizer: any) => {\n        const sldSymbolizerName: string = Object.keys(sldSymbolizer)[0];\n        switch (sldSymbolizerName) {\n          case 'PointSymbolizer':\n            return this.getPointSymbolizerFromSldSymbolizer(sldSymbolizer.PointSymbolizer);\n          case 'LineSymbolizer':\n            return this.getLineSymbolizerFromSldSymbolizer(sldSymbolizer.LineSymbolizer);\n          case 'TextSymbolizer':\n            return this.getTextSymbolizerFromSldSymbolizer(sldSymbolizer.TextSymbolizer);\n          case 'PolygonSymbolizer':\n            return this.getFillSymbolizerFromSldSymbolizer(sldSymbolizer.PolygonSymbolizer);\n          case 'RasterSymbolizer':\n            return this.getRasterSymbolizerFromSldSymbolizer(sldSymbolizer.RasterSymbolizer);\n          default:\n            throw new Error('Failed to parse SymbolizerKind from SldRule');\n        }\n      });\n\n    return symbolizers;\n  }\n\n  /**\n   * Creates a geostyler-style Filter from a given operator name and the js\n   * SLD object representation (created with fast-xml-parser) of the SLD Filter.\n   *\n   * @param sldOperatorName The Name of the SLD Filter Operator\n   * @param sldFilter The SLD Filter\n   * @return The geostyler-style Filter\n   */\n  getFilterFromOperatorAndComparison(sldOperatorName: string, sldFilter: any): GsFilter {\n    let filter: GsFilter;\n\n    if (sldOperatorName === 'Function') {\n      const functionName = sldFilter[0][':@']['@_name'];\n      const tempFunctionName = functionName.charAt(0).toUpperCase() + functionName.slice(1);\n      sldOperatorName = `PropertyIs${tempFunctionName}`;\n    }\n\n    // we have to first check for PropertyIsBetween,\n    // since it is also a comparisonOperator. But it\n    // needs to be treated differently.\n    if (sldOperatorName === 'PropertyIsBetween') {\n      // TODO: PropertyIsBetween spec allows more than just a PropertyName as its first argument.\n      const propertyName = get(sldFilter, 'PropertyIsBetween.PropertyName.#text');\n      const lower = Number(get(sldFilter, 'PropertyIsBetween.LowerBoundary.Literal.#text'));\n      const upper = Number(get(sldFilter, 'PropertyIsBetween.UpperBoundary.Literal.#text'));\n\n      filter = ['<=x<=', propertyName, lower, upper];\n    } else if (Object.keys(SldStyleParser.comparisonMap).includes(sldOperatorName)) {\n      const comparisonOperator: ComparisonOperator = SldStyleParser.comparisonMap[sldOperatorName];\n      const filterIsFunction = !!get(sldFilter, 'Function');\n      let args: any[] = [];\n      const childrenToArgs = (child: any) => {\n        if (get([child], '#text') !== undefined) {\n          return get([child], '#text');\n        } else {\n          return get([child], 'PropertyName.#text');\n        }\n      };\n\n      const children = get(sldFilter, filterIsFunction ? 'Function' : sldOperatorName) || [];\n      args = children.map(childrenToArgs);\n\n      if (sldOperatorName === 'PropertyIsNull') {\n        args[1] = null;\n      }\n\n      filter = [\n        comparisonOperator,\n        ...args\n      ] as ComparisonFilter;\n\n    } else if (Object.keys(SldStyleParser.combinationMap).includes(sldOperatorName)) {\n      const combinationOperator: CombinationOperator = SldStyleParser.combinationMap[sldOperatorName];\n      const filters: GsFilter[] = get(sldFilter, sldOperatorName)?.map((op: any) => {\n        const operatorName = Object.keys(op)?.[0];\n        return this.getFilterFromOperatorAndComparison(operatorName, op);\n      });\n      filter = [\n        combinationOperator,\n        ...filters\n      ];\n    } else if (Object.keys(SldStyleParser.negationOperatorMap).includes(sldOperatorName)) {\n      const negationOperator = SldStyleParser.negationOperatorMap[sldOperatorName];\n      const negatedOperator = Object.keys(sldFilter[sldOperatorName][0])[0];\n      const negatedComparison = sldFilter[sldOperatorName][0];\n      const negatedFilter: GsFilter = this.getFilterFromOperatorAndComparison(\n        negatedOperator,\n        negatedComparison\n      );\n      filter = [\n        negationOperator,\n        negatedFilter\n      ];\n    } else {\n      throw new Error('No Filter detected');\n    }\n    return filter;\n  }\n\n  /**\n   * Get the geostyler-style PointSymbolizer from a SLD Symbolizer.\n   *\n   * The opacity of the Symbolizer is taken from the <Graphic>.\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style PointSymbolizer\n   */\n  getPointSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsPointSymbolizer {\n    let pointSymbolizer: GsPointSymbolizer;\n    const wellKnownName: string = get(sldSymbolizer, 'Graphic.Mark.WellKnownName.#text');\n    const externalGraphic: any = get(sldSymbolizer, 'Graphic.ExternalGraphic');\n    if (externalGraphic) {\n      pointSymbolizer = this.getIconSymbolizerFromSldSymbolizer(sldSymbolizer);\n    } else {\n      // geoserver does not set a wellKnownName for square explicitly since it is the default value.\n      // Therefore, we have to set the wellKnownName to square if no wellKownName is given.\n      if (!wellKnownName) {\n        // TODO: Fix this. Idealy without lodash\n        // _set(sldSymbolizer, 'Graphic[0].Mark[0].WellKnownName[0]._', 'square');\n      }\n      pointSymbolizer = this.getMarkSymbolizerFromSldSymbolizer(sldSymbolizer);\n    }\n    return pointSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style LineSymbolizer from a SLD Symbolizer.\n   *\n   * Currently only the CssParameters are available.\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style LineSymbolizer\n   */\n  getLineSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsLineSymbolizer {\n    const lineSymbolizer: GsLineSymbolizer = {\n      kind: 'Line'\n    };\n    const strokeEl = get(sldSymbolizer, 'Stroke');\n    const color = getParameterValue(strokeEl, 'stroke', this.sldVersion);\n    const width = getParameterValue(strokeEl, 'stroke-width', this.sldVersion);\n    const opacity = getParameterValue(strokeEl, 'stroke-opacity', this.sldVersion);\n    const lineJoin = getParameterValue(strokeEl, 'stroke-linejoin', this.sldVersion);\n    const lineCap = getParameterValue(strokeEl, 'stroke-linecap', this.sldVersion);\n    const dashArray = getParameterValue(strokeEl, 'stroke-dasharray', this.sldVersion);\n    const dashOffset = getParameterValue(strokeEl, 'stroke-dashoffset', this.sldVersion);\n\n    if (color) {\n      lineSymbolizer.color = color;\n    }\n    if (width !== undefined) {\n      lineSymbolizer.width = numberExpression(width);\n    }\n    if (opacity !== undefined) {\n      lineSymbolizer.opacity = numberExpression(opacity);\n    }\n    if (lineJoin) {\n      // geostyler-style and ol use 'miter' whereas sld uses 'mitre'\n      if (lineJoin === 'mitre') {\n        lineSymbolizer.join = 'miter';\n      } else {\n        lineSymbolizer.join = lineJoin as 'bevel' | 'miter' | 'round' | undefined;\n      }\n    }\n    if (lineCap) {\n      lineSymbolizer.cap = lineCap as 'round' | 'butt' | 'square' | undefined;\n    }\n\n    if (dashArray) {\n      const dashStringAsArray = dashArray.split(' ').map(numberExpression);\n      lineSymbolizer.dasharray = dashStringAsArray;\n    }\n    if (dashOffset) {\n      lineSymbolizer.dashOffset = numberExpression(dashOffset);\n    }\n\n    const graphicStroke = get(strokeEl, 'GraphicStroke');\n    if (graphicStroke !== undefined) {\n      lineSymbolizer.graphicStroke = this.getPointSymbolizerFromSldSymbolizer(graphicStroke);\n    }\n\n    const graphicFill = get(strokeEl, 'GraphicFill');\n    if (graphicFill !== undefined) {\n      lineSymbolizer.graphicFill = this.getPointSymbolizerFromSldSymbolizer(graphicFill);\n    }\n\n    const perpendicularOffset = get(sldSymbolizer, 'PerpendicularOffset.#text');\n    if (perpendicularOffset !== undefined) {\n      lineSymbolizer.perpendicularOffset = numberExpression(perpendicularOffset);\n    }\n\n    return lineSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style TextSymbolizer from a SLD Symbolizer.\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style TextSymbolizer\n   */\n  getTextSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsTextSymbolizer {\n    const textSymbolizer: GsTextSymbolizer = {\n      kind: 'Text'\n    };\n    const fontEl = get(sldSymbolizer, 'Font');\n    const fillEl = get(sldSymbolizer, 'Fill');\n    const labelEl = get(sldSymbolizer, 'Label');\n    const haloEl = get(sldSymbolizer, 'Halo');\n    const haloFillEl = get(haloEl, 'Fill');\n\n    const color = getParameterValue(fillEl, 'fill', this.sldVersion);\n    const opacity = getParameterValue(fillEl, 'fill-opacity', this.sldVersion);\n\n    const fontFamily = getParameterValue(fontEl, 'font-family', this.sldVersion);\n    const fontStyle = getParameterValue(fontEl, 'font-style', this.sldVersion);\n    const fontSize = getParameterValue(fontEl, 'font-size', this.sldVersion);\n    const fontWeight = getParameterValue(fontEl, 'font-weight', this.sldVersion);\n\n    const haloColor = getParameterValue(haloFillEl, 'fill', this.sldVersion);\n\n    if (labelEl) {\n      textSymbolizer.label = this.getTextSymbolizerLabelFromSldSymbolizer(labelEl);\n    }\n\n    textSymbolizer.color = color ? color : '#000000';\n    textSymbolizer.opacity = opacity ? numberExpression(opacity) : 1;\n\n    const haloRadius = get(sldSymbolizer, 'Halo.Radius.#text');\n    if (haloRadius) {\n      textSymbolizer.haloWidth = numberExpression(haloRadius);\n    }\n    const haloOpacity = getParameterValue(haloFillEl, 'fill-opacity', this.sldVersion);\n    if (haloOpacity) {\n      textSymbolizer.haloOpacity = numberExpression(haloOpacity);\n    }\n    if (haloColor) {\n      textSymbolizer.haloColor = haloColor;\n    }\n    const displacement = get(sldSymbolizer, 'LabelPlacement.PointPlacement.Displacement');\n    if (displacement) {\n      const x = get(displacement, 'DisplacementX.#text');\n      const y = get(displacement, 'DisplacementY.#text');\n      textSymbolizer.offset = [\n        x ? parseFloat(x) : 0,\n        y ? parseFloat(y) : 0,\n      ];\n    }\n    const rotation = get(sldSymbolizer, 'LabelPlacement.PointPlacement.Rotation.#text');\n    if (rotation) {\n      textSymbolizer.rotate = numberExpression(rotation);\n    }\n    if (fontFamily) {\n      textSymbolizer.font = [fontFamily];\n    }\n    if (fontStyle) {\n      textSymbolizer.fontStyle = fontStyle.toLowerCase() as 'normal' | 'italic' | 'oblique' | undefined;\n    }\n    if (fontWeight) {\n      textSymbolizer.fontWeight = fontWeight.toLowerCase() as 'normal' | 'bold' | undefined;\n    }\n    if (fontSize) {\n      textSymbolizer.size = numberExpression(fontSize);\n    }\n    return textSymbolizer;\n  }\n\n  /**\n   * Create a template string from a TextSymbolizer Label element.\n   * The ordering of the elemments inside the Label element is preserved.\n   *\n   * Examples:\n   * <Label>\n   *  <Literal>foo</Literal>\n   *  <PropertyName>bar</PropertyName>\n   * </Label>\n   * --> \"foo{{bar}}\"\n   *\n   * <Label>\n   *  <PropertyName>bar</PropertyName>\n   *  <Literal>foo</Literal>\n   * </Label>\n   * --> \"{{bar}}foo\"\n   *\n   * <Label>\n   *  <PropertyName>bar</PropertyName>\n   *  <Literal>foo</Literal>\n   *  <PropertyName>john</PropertyName>\n   * </Label>\n   * --> \"{{bar}}foo{{john}}\"\n   *\n   * <Label>\n   *  <PropertyName>bar</PropertyName>\n   *  <PropertyName>john</PropertyName>\n   *  <Literal>foo</Literal>\n   * </Label>\n   * --> \"{{bar}}{{john}}foo\"\n   *\n   * <Label>\n   *  <PropertyName>bar</PropertyName>\n   *  <PropertyName>john</PropertyName>\n   *  <Literal>foo</Literal>\n   *  <PropertyName>doe</PropertyName>\n   * </Label>\n   * --> \"{{bar}}{{john}}foo{{doe}}\"\n   *\n   * @param sldLabel\n   */\n  getTextSymbolizerLabelFromSldSymbolizer = (sldLabel: any): string => {\n    const label: string = sldLabel\n      .map((labelEl: any) => {\n        const labelName = Object.keys(labelEl)[0];\n        switch (labelName.replace('ogc:', '')) {\n          case '#text':\n            return labelEl['#text'];\n          case 'Literal':\n            return labelEl?.[labelName]?.[0 ]?.['#text'] || labelEl?.[labelName]?.[0]?.['#cdata']?.[0]?.['#text'];\n          case 'PropertyName':\n            const propName = labelEl[labelName][0]['#text'];\n            return `{{${propName}}}`;\n          default:\n            return '';\n        }\n      })\n      .join('');\n    return label;\n  };\n\n  /**\n   * Get the geostyler-style FillSymbolizer from a SLD Symbolizer.\n   *\n   * PolygonSymbolizer Stroke is just partially supported.\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style FillSymbolizer\n   */\n  getFillSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsFillSymbolizer {\n    const fillSymbolizer: GsFillSymbolizer = {\n      kind: 'Fill'\n    };\n    const strokeEl = get(sldSymbolizer, 'Stroke');\n    const fillEl = get(sldSymbolizer, 'Fill');\n\n    const fillOpacity = getParameterValue(fillEl, 'fill-opacity', this.sldVersion);\n    const color = getParameterValue(fillEl, 'fill', this.sldVersion);\n\n    const outlineColor = getParameterValue(strokeEl, 'stroke', this.sldVersion);\n    const outlineWidth = getParameterValue(strokeEl, 'stroke-width', this.sldVersion);\n    const outlineOpacity = getParameterValue(strokeEl, 'stroke-opacity', this.sldVersion);\n    const outlineDashArray = getParameterValue(strokeEl, 'stroke-dasharray', this.sldVersion);\n    const outlineCap = getParameterValue(strokeEl, 'stroke-linecap', this.sldVersion);\n    const outlineJoin = getParameterValue(strokeEl, 'stroke-linejoin', this.sldVersion);\n    // const outlineDashOffset = getParameterValue(strokeEl, 'stroke-dashoffset', this.sldVersion);\n\n    const graphicFill = get(sldSymbolizer, 'Fill.GraphicFill');\n    if (graphicFill) {\n      fillSymbolizer.graphicFill = this.getPointSymbolizerFromSldSymbolizer(\n        graphicFill\n      );\n    }\n    if (color) {\n      fillSymbolizer.color = color;\n    }\n    if (fillOpacity) {\n      fillSymbolizer.fillOpacity = numberExpression(fillOpacity);\n    }\n\n    if (outlineColor) {\n      fillSymbolizer.outlineColor = outlineColor;\n    }\n    if (outlineWidth) {\n      fillSymbolizer.outlineWidth = numberExpression(outlineWidth);\n    }\n    if (outlineOpacity) {\n      fillSymbolizer.outlineOpacity = numberExpression(outlineOpacity);\n    }\n    if (outlineDashArray) {\n      fillSymbolizer.outlineDasharray = outlineDashArray.split(' ').map(numberExpression);\n    }\n    if (outlineCap) {\n      fillSymbolizer.outlineCap = outlineCap;\n    }\n    if (outlineJoin) {\n      fillSymbolizer.outlineJoin = outlineJoin;\n    }\n    // TODO: seems like this is missing in the geostyer-stlye\n    // if (outlineDashOffset) {\n    //   fillSymbolizer.outlineDashOffset = Number(outlineDashOffset);\n    // }\n    return fillSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style RasterSymbolizer from a SLD Symbolizer.\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   */\n  getRasterSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsRasterSymbolizer {\n    const rasterSymbolizer: GsRasterSymbolizer = {\n      kind: 'Raster'\n    };\n      // parse Opacity\n    let opacity = get(sldSymbolizer, 'Opacity.#text');\n    if (opacity) {\n      opacity = numberExpression(opacity);\n      rasterSymbolizer.opacity = opacity;\n    }\n    // parse ColorMap\n    const sldColorMap = get(sldSymbolizer, 'ColorMap');\n    const sldColorMapType = get(sldSymbolizer, 'ColorMap.@type');\n    const extended = get(sldSymbolizer, 'ColorMap.@extended');\n    if (sldColorMap) {\n      const colormap = this.getColorMapFromSldColorMap(sldColorMap, sldColorMapType, extended);\n      rasterSymbolizer.colorMap = colormap;\n    }\n    // parse ChannelSelection\n    const sldChannelSelection = get(sldSymbolizer, 'ChannelSelection');\n    if (sldChannelSelection) {\n      const channelSelection = this.getChannelSelectionFromSldChannelSelection(sldChannelSelection);\n      rasterSymbolizer.channelSelection = channelSelection;\n    }\n    // parse ContrastEnhancement\n    const sldContrastEnhancement = get(sldSymbolizer, 'ContrastEnhancement');\n    if (sldContrastEnhancement) {\n      const contrastEnhancement = this.getContrastEnhancementFromSldContrastEnhancement(sldContrastEnhancement);\n      rasterSymbolizer.contrastEnhancement = contrastEnhancement;\n    }\n    return rasterSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style MarkSymbolizer from a SLD Symbolizer\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style MarkSymbolizer\n   */\n  getMarkSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsMarkSymbolizer {\n    const wellKnownName: GsWellKnownName = get(sldSymbolizer, 'Graphic.Mark.WellKnownName.#text');\n    const strokeEl = get(sldSymbolizer, 'Graphic.Mark.Stroke');\n    const fillEl = get(sldSymbolizer, 'Graphic.Mark.Fill');\n\n    const opacity = get(sldSymbolizer, 'Graphic.Opacity.#text');\n    const size = get(sldSymbolizer, 'Graphic.Size.#text');\n    const rotation = get(sldSymbolizer, 'Graphic.Rotation.#text');\n    const fillOpacity = getParameterValue(fillEl, 'fill-opacity', this.sldVersion);\n    const color = getParameterValue(fillEl, 'fill', this.sldVersion);\n\n    const markSymbolizer: GsMarkSymbolizer = {\n      kind: 'Mark',\n      wellKnownName: 'circle'\n    };\n\n    if (opacity) {\n      markSymbolizer.opacity = numberExpression(opacity);\n    }\n    if (fillOpacity) {\n      markSymbolizer.fillOpacity = numberExpression(fillOpacity);\n    }\n    if (color) {\n      markSymbolizer.color = color;\n    }\n    if (rotation) {\n      markSymbolizer.rotate = numberExpression(rotation) ;\n    }\n    if (size) {\n      // edge case where the value has to be divided by 2 which has to be considered in the function\n      markSymbolizer.radius = isGeoStylerNumberFunction(size) ? size : Number(size) / 2;\n    }\n\n    switch (wellKnownName) {\n      case 'circle':\n      case 'square':\n      case 'triangle':\n      case 'star':\n      case 'cross':\n      case 'x':\n      case 'shape://vertline':\n      case 'shape://horline':\n      case 'shape://slash':\n      case 'shape://backslash':\n      case 'shape://dot':\n      case 'shape://plus':\n      case 'shape://times':\n      case 'shape://oarrow':\n      case 'shape://carrow':\n        markSymbolizer.wellKnownName = wellKnownName;\n        break;\n      default:\n        if (WELLKNOWNNAME_TTF_REGEXP.test(wellKnownName)) {\n          markSymbolizer.wellKnownName = wellKnownName;\n          break;\n        }\n        throw new Error('MarkSymbolizer cannot be parsed. Unsupported WellKnownName.');\n    }\n\n    const strokeColor = getParameterValue(strokeEl, 'stroke', this.sldVersion);\n    if (strokeColor) {\n      markSymbolizer.strokeColor = strokeColor;\n    }\n    const strokeWidth = getParameterValue(strokeEl, 'stroke-width', this.sldVersion);\n    if (strokeWidth) {\n      markSymbolizer.strokeWidth = numberExpression(strokeWidth);\n    }\n    const strokeOpacity = getParameterValue(strokeEl, 'stroke-opacity', this.sldVersion);\n    if (strokeOpacity) {\n      markSymbolizer.strokeOpacity = numberExpression(strokeOpacity);\n    }\n\n    return markSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style IconSymbolizer from a SLD Symbolizer\n   *\n   * @param sldSymbolizer The SLD Symbolizer\n   * @return The geostyler-style IconSymbolizer\n   */\n  getIconSymbolizerFromSldSymbolizer(sldSymbolizer: any): GsIconSymbolizer {\n    const image = get(sldSymbolizer, 'Graphic.ExternalGraphic.OnlineResource.@href');\n    const iconSymbolizer: GsIconSymbolizer = <GsIconSymbolizer> {\n      kind: 'Icon',\n      image\n    };\n    const opacity: string = get(sldSymbolizer, 'Graphic.Opacity.#text');\n    const size: string = get(sldSymbolizer, 'Graphic.Size.#text');\n    const rotation: string = get(sldSymbolizer, 'Graphic.Rotation.#text');\n    if (opacity) {\n      iconSymbolizer.opacity = numberExpression(opacity);\n    }\n    if (size) {\n      iconSymbolizer.size = numberExpression(size);\n    }\n    if (rotation) {\n      iconSymbolizer.rotate = numberExpression(rotation);\n    }\n    return iconSymbolizer;\n  }\n\n  /**\n   * Get the geostyler-style ColorMap from a SLD ColorMap.\n   *\n   * @param sldColorMap The SLD ColorMap\n   */\n  getColorMapFromSldColorMap(sldColorMap: any, type: ColorMapType = 'ramp', extended?: string): ColorMap {\n    const colorMap: ColorMap = {\n      type\n    };\n\n    if (extended) {\n      if (extended === 'true') {\n        colorMap.extended = true;\n      } else {\n        colorMap.extended = false;\n      }\n    }\n\n    const colorMapEntries = getChildren(sldColorMap, 'ColorMapEntry');\n    if (Array.isArray(colorMapEntries)) {\n      const cmEntries = colorMapEntries.map((cm) => {\n        const color = getAttribute(cm, 'color');\n        if (!color) {\n          throw new Error('Cannot parse ColorMapEntries. color is undefined.');\n        }\n        let quantity = getAttribute(cm, 'quantity');\n        if (quantity) {\n          quantity = numberExpression(quantity);\n        }\n        const label = getAttribute(cm, 'label');\n        let opacity = getAttribute(cm, 'opacity');\n        if (opacity) {\n          opacity = numberExpression(opacity);\n        }\n        return {\n          color,\n          quantity,\n          label,\n          opacity\n        } as ColorMapEntry;\n      });\n      colorMap.colorMapEntries = cmEntries;\n    }\n\n    return colorMap;\n  }\n\n  /**\n   * Get the geostyler-style ContrastEnhancement from a SLD ContrastEnhancement.\n   *\n   * @param sldContrastEnhancement The SLD ContrastEnhancement\n   */\n  getContrastEnhancementFromSldContrastEnhancement(sldContrastEnhancement: any): ContrastEnhancement {\n    const contrastEnhancement: ContrastEnhancement = {};\n\n    // parse enhancementType\n    const hasHistogram = !!get(sldContrastEnhancement, 'Histogram');\n    const hasNormalize = !!get(sldContrastEnhancement, 'Normalize');\n    if (hasHistogram && hasNormalize) {\n      throw new Error(`Cannot parse ContrastEnhancement. Histogram and Normalize\n        are mutually exclusive.`);\n    } else if (hasHistogram) {\n      contrastEnhancement.enhancementType = 'histogram';\n    } else if (hasNormalize) {\n      contrastEnhancement.enhancementType = 'normalize';\n    }\n    // parse gammavalue\n    let gammaValue = get(sldContrastEnhancement, 'GammaValue.#text');\n    if (gammaValue) {\n      gammaValue = numberExpression(gammaValue);\n    }\n    contrastEnhancement.gammaValue = gammaValue;\n\n    return contrastEnhancement;\n  }\n\n  /**\n   * Get the geostyler-style Channel from a SLD Channel.\n   *\n   * @param sldChannel The SLD Channel\n   */\n  getChannelFromSldChannel(sldChannel: any): Channel {\n    const sourceChannelName = get(sldChannel, 'SourceChannelName.#text')?.toString();\n    const channel: Channel = {\n      sourceChannelName\n    };\n    const contrastEnhancement = get(sldChannel, 'ContrastEnhancement');\n    if (contrastEnhancement) {\n      channel.contrastEnhancement = this.getContrastEnhancementFromSldContrastEnhancement(contrastEnhancement);\n    }\n    return channel;\n  }\n\n  /**\n   * Get the geostyler-style ChannelSelection from a SLD ChannelSelection.\n   *\n   * @param sldChannelSelection The SLD ChannelSelection\n   */\n  getChannelSelectionFromSldChannelSelection(sldChannelSelection: any): ChannelSelection {\n    let channelSelection: ChannelSelection;\n    const red = get(sldChannelSelection, 'RedChannel');\n    const blue = get(sldChannelSelection, 'BlueChannel');\n    const green = get(sldChannelSelection, 'GreenChannel');\n    const gray = get(sldChannelSelection, 'GrayChannel');\n\n    if (gray && red && blue && green) {\n      throw new Error('Cannot parse ChannelSelection. RGB and Grayscale are mutually exclusive');\n    }\n    if (gray) {\n      const grayChannel = this.getChannelFromSldChannel(gray);\n      channelSelection = {\n        grayChannel\n      };\n    } else if (red && green && blue) {\n      const redChannel = this.getChannelFromSldChannel(red);\n      const blueChannel = this.getChannelFromSldChannel(blue);\n      const greenChannel = this.getChannelFromSldChannel(green);\n      channelSelection = {\n        redChannel,\n        blueChannel,\n        greenChannel\n      };\n    } else {\n      throw new Error('Cannot parse ChannelSelection. Red, Green and Blue channels must be defined.');\n    }\n    return channelSelection;\n  }\n\n  /**\n   * The writeStyle implementation of the geostyler-style StyleParser interface.\n   * It reads a geostyler-style and returns a Promise.\n   * The Promise itself resolves with a SLD string.\n   *\n   * @param geoStylerStyle A geostyler-style.\n   * @return The Promise resolving with the SLD as a string.\n   */\n  writeStyle(geoStylerStyle: Style): Promise<WriteStyleResult<string>> {\n    return new Promise<WriteStyleResult<string>>(resolve => {\n      const unsupportedProperties = this.checkForUnsupportedProperites(geoStylerStyle);\n      try {\n        const sldObject = this.geoStylerStyleToSldObject(geoStylerStyle);\n        const sldString = this.builder.build(sldObject);\n        resolve({\n          output: sldString,\n          unsupportedProperties,\n          warnings: unsupportedProperties && ['Your style contains unsupportedProperties!']\n        });\n      } catch (error) {\n        resolve({\n          errors: [error]\n        });\n      }\n    });\n  }\n\n  /**\n   * Get the correct tagName in dependency to the configured sldVersion.\n   *\n   * @param tagName\n   * @returns The tagName as used by the configured sldVersion\n   */\n  getTagName(tagName: string): string {\n    const ogcList = ['Filter'];\n    if (ogcList.includes(tagName)) {\n      return this.sldVersion === '1.1.0' ? `ogc:${tagName}` : tagName;\n    }\n    if (tagName === 'CssParameter') {\n      return this.sldVersion === '1.1.0' ? 'se:SvgParameter' : 'CssParameter';\n    }\n    return this.sldVersion === '1.1.0' ? `se:${tagName}` : tagName;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style\n   *\n   * @param geoStylerStyle A geostyler-style.\n   * @return The object representation of a SLD Style (readable with fast-xml-parser)\n   */\n  geoStylerStyleToSldObject(geoStylerStyle: Style): any {\n    const rules: any[] = this.getSldRulesFromRules(geoStylerStyle.rules);\n    // add the ogc namespace to the filter element, if a filter is present\n    rules.forEach(rule => {\n      if (rule.Filter && !rule.Filter['@_xmlns']) {\n        rule.Filter['@_xmlns'] = 'http://www.opengis.net/ogc';\n      }\n    });\n\n    const featureTypeStyle = [\n      ...rules\n    ];\n    const Name = this.getTagName('Name');\n    const Title = this.getTagName('Title');\n    const FeatureTypeStyle = this.getTagName('FeatureTypeStyle');\n\n    const attributes = {\n      '@_version': this.sldVersion,\n      '@_xsi:schemaLocation': 'http://www.opengis.net/sld StyledLayerDescriptor.xsd',\n      '@_xmlns': 'http://www.opengis.net/sld',\n      '@_xmlns:ogc': 'http://www.opengis.net/ogc',\n      '@_xmlns:xlink': 'http://www.w3.org/1999/xlink',\n      '@_xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance'\n    };\n\n    if (this.sldVersion === '1.1.0') {\n      attributes['@_xmlns:se'] = 'http://www.opengis.net/se';\n    }\n\n    return [{\n      '?xml': [{ '#text': '' }],\n      ':@': {\n        '@_version': '1.0',\n        '@_encoding': 'UTF-8',\n        '@_standalone': 'yes'\n      },\n    }, {\n      StyledLayerDescriptor: [{\n        NamedLayer: [{\n          [Name]: [{ '#text': geoStylerStyle.name || '' }]\n        }, {\n          UserStyle: [{\n            [Name]: [{ '#text': geoStylerStyle.name || '' }]\n          }, {\n            [Title]: [{ '#text': geoStylerStyle.name || '' }]\n          }, {\n            [FeatureTypeStyle]: featureTypeStyle\n          }]\n        }]\n      }],\n      ':@': attributes\n    }];\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style Rule.\n   *\n   * @param rules An array of geostyler-style Rules.\n   * @return The object representation of a SLD Rule (readable with fast-xml-parser)\n   */\n  getSldRulesFromRules(rules: GsRule[]): any[] {\n    const Name = this.getTagName('Name');\n    const Filter = this.getTagName('Filter');\n    const Rule = this.getTagName('Rule');\n    const MinScaleDenominator = this.getTagName('MinScaleDenominator');\n    const MaxScaleDenominator = this.getTagName('MaxScaleDenominator');\n\n    return rules.map((rule: GsRule) => {\n      const sldRule: any = {\n        [Rule]: []\n      };\n      if (rule.name) {\n        sldRule[Rule].push({\n          [Name]: [{\n            '#text': rule.name\n          }]\n        });\n      }\n      if (rule.filter) {\n        const filter = this.getSldFilterFromFilter(rule.filter);\n        sldRule[Rule].push({\n          [Filter]: filter\n        });\n      }\n      if (rule.scaleDenominator) {\n        const { min, max } = rule.scaleDenominator;\n        if (min && Number.isFinite(min)) {\n          sldRule[Rule].push({\n            [MinScaleDenominator]: [{\n              '#text': min\n            }]\n          });\n        }\n        if (max && Number.isFinite(max)) {\n          sldRule[Rule].push({\n            [MaxScaleDenominator]: [{\n              '#text': max\n            }]\n          });\n        }\n      }\n\n      // Remove empty Symbolizers and check if there is at least 1 symbolizer\n      const symbolizers = this.getSldSymbolizersFromSymbolizers(rule.symbolizers);\n      let symbolizerKeys: string[] = [];\n      if (symbolizers.length > 0) {\n        symbolizerKeys = Object.keys(symbolizers[0]);\n      }\n      symbolizerKeys.forEach((key: string) => {\n        if (symbolizers[0][key].length === 0) {\n          delete symbolizers[0][key];\n        }\n      });\n\n      if (symbolizers.length > 0 && symbolizerKeys.length !== 0) {\n        sldRule[Rule] = [\n          ...sldRule[Rule],\n          ...symbolizers\n        ];\n      }\n      return sldRule;\n    });\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style ComparisonFilter.\n   *\n   * @param comparisonFilter A geostyler-style ComparisonFilter.\n   * @return The object representation of a SLD Filter Expression with a\n   * comparison operator (readable with fast-xml-parser)\n   */\n  getSldComparisonFilterFromComparisonFilter(comparisonFilter: ComparisonFilter): any[] {\n    const sldComparisonFilter: any = [];\n    const operator = comparisonFilter[0];\n    const key = comparisonFilter[1];\n    const value = comparisonFilter[2];\n\n    const sldOperators: string[] = keysByValue(SldStyleParser.comparisonMap, operator);\n    const sldOperator: string = (sldOperators.length > 1 && value === null)\n      ? sldOperators[1] : sldOperators[0];\n\n    const propertyKey = 'PropertyName';\n\n    if (isGeoStylerFunction(key) || isGeoStylerFunction(value)) {\n      const tempOperator = sldOperator.replace('PropertyIs', '');\n      const sldFunctionOperator = tempOperator.charAt(0).toLowerCase() + tempOperator.slice(1);\n      const keyResult = isGeoStylerFunction(key) ? geoStylerFunctionToSldFunction(key) : key;\n      const valueResult = isGeoStylerFunction(value) ? geoStylerFunctionToSldFunction(value) : value;\n\n      const functionChildren: any = [];\n\n      if (isGeoStylerFunction(key)) {\n        functionChildren.unshift(keyResult?.[0]);\n      } else {\n        functionChildren.unshift({\n          Literal: [{\n            '#text': keyResult\n          }]\n        });\n      }\n\n      if (isGeoStylerFunction(value)) {\n        functionChildren.push(valueResult?.[0]);\n      } else {\n        functionChildren.push({\n          Literal: [{\n            '#text': valueResult\n          }]\n        });\n      }\n\n      return [{\n        Function: functionChildren,\n        ':@': {\n          '@_name': sldFunctionOperator\n        }\n      }];\n    }\n\n    if (sldOperator === 'PropertyIsNull') {\n      // empty, selfclosing Literals are not valid in a propertyIsNull filter\n      sldComparisonFilter.push({\n        [sldOperator]: [{\n          [propertyKey]: [{\n            '#text': key\n          }]\n        }]\n      });\n    } else if (sldOperator === 'PropertyIsLike') {\n      sldComparisonFilter.push({\n        [sldOperator]: [{\n          [propertyKey]: [{\n            '#text': key\n          }]\n        }, {\n          Literal: [{\n            '#text': value\n          }]\n        }],\n        [':@']: {\n          '@_wildCard': '*',\n          '@_singleChar': '.',\n          '@_escape': '!',\n        }\n      });\n    } else if (sldOperator === 'PropertyIsBetween') {\n      // Currently we only support Literals as values.\n      const betweenFilter = comparisonFilter as RangeFilter;\n      sldComparisonFilter.push({\n        [sldOperator]: [{\n          [propertyKey]: [{\n            '#text': key\n          }]\n        }, {\n          LowerBoundary: [{\n            Literal: [{\n              '#text': betweenFilter[2]\n            }]\n          }]\n        }, {\n          UpperBoundary: [{\n            Literal: [{\n              '#text': betweenFilter[3]\n            }]\n          }]\n        }]\n      });\n    } else {\n      sldComparisonFilter.push({\n        [sldOperator]: [{\n          [propertyKey]: [{\n            '#text': key\n          }]\n        }, {\n          Literal: [{\n            '#text': value\n          }]\n        }]\n      });\n    }\n\n\n    return sldComparisonFilter;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style Filter.\n   *\n   * @param filter A geostyler-style Filter.\n   * @return The object representation of a SLD Filter Expression (readable with fast-xml-parser)\n   */\n  getSldFilterFromFilter(filter: GsFilter): any[] {\n    let sldFilter: any[] = [];\n\n    if (isComparisonFilter(filter)) {\n      sldFilter = this.getSldComparisonFilterFromComparisonFilter(filter);\n    } else if (isNegationFilter(filter)) {\n      sldFilter.push({\n        Not: this.getSldFilterFromFilter(filter[1])\n      });\n    } else if (isCombinationFilter(filter)) {\n      const [\n        operator,\n        ...args\n      ] = filter;\n      const sldOperators: string[] = keysByValue(SldStyleParser.combinationMap, operator);\n      const combinator = sldOperators[0];\n      const sldSubFilters = args.map(subFilter => this.getSldFilterFromFilter(subFilter)[0]);\n      sldFilter.push({\n        [combinator]: sldSubFilters\n      });\n    }\n    return sldFilter;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from geostyler-style Symbolizers.\n   *\n   * @param symbolizers A geostyler-style Symbolizer array.\n   * @return The object representation of a SLD Symbolizer (readable with fast-xml-parser)\n   */\n  getSldSymbolizersFromSymbolizers(symbolizers: Symbolizer[]): any {\n    const sldSymbolizers: any = [];\n    const PointSymbolizer = this.getTagName('PointSymbolizer');\n    const TextSymbolizer = this.getTagName('TextSymbolizer');\n    const LineSymbolizer = this.getTagName('LineSymbolizer');\n    const PolygonSymbolizer = this.getTagName('PolygonSymbolizer');\n    const RasterSymbolizer = this.getTagName('RasterSymbolizer');\n\n    symbolizers.forEach(symb => {\n      const sldSymbolizer: any = {};\n      let sldSymb: any[];\n      switch (symb.kind) {\n        case 'Mark':\n          sldSymb = this.getSldPointSymbolizerFromMarkSymbolizer(symb);\n          sldSymbolizer[PointSymbolizer] = sldSymb;\n          break;\n        case 'Icon':\n          sldSymb = this.getSldPointSymbolizerFromIconSymbolizer(symb);\n          sldSymbolizer[PointSymbolizer] = sldSymb;\n          break;\n        case 'Text':\n          sldSymb = this.getSldTextSymbolizerFromTextSymbolizer(symb);\n          sldSymbolizer[TextSymbolizer] = sldSymb;\n          break;\n        case 'Line':\n          sldSymb = this.getSldLineSymbolizerFromLineSymbolizer(symb);\n          sldSymbolizer[LineSymbolizer] = sldSymb;\n          break;\n        case 'Fill':\n          sldSymb = this.getSldPolygonSymbolizerFromFillSymbolizer(symb);\n          sldSymbolizer[PolygonSymbolizer] = sldSymb;\n          break;\n        case 'Raster':\n          sldSymb = this.getSldRasterSymbolizerFromRasterSymbolizer(symb);\n          sldSymbolizer[RasterSymbolizer] = sldSymb;\n          break;\n        default:\n          break;\n      }\n      sldSymbolizers.push(sldSymbolizer);\n    });\n    return sldSymbolizers;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style MarkSymbolizer.\n   *\n   * @param markSymbolizer A geostyler-style MarkSymbolizer.\n   * @return The object representation of a SLD PointSymbolizer with a Mark\n   */\n  getSldPointSymbolizerFromMarkSymbolizer(markSymbolizer: GsMarkSymbolizer): any {\n    const WellKnownName = this.getTagName('WellKnownName');\n    const CssParameter = this.getTagName('CssParameter');\n    const Fill = this.getTagName('Fill');\n    const Mark = this.getTagName('Mark');\n    const Stroke = this.getTagName('Stroke');\n    const Opacity = this.getTagName('Opacity');\n    const Rotation = this.getTagName('Rotation');\n    const Size = this.getTagName('Size');\n    const Graphic = this.getTagName('Graphic');\n\n    const isFontSymbol = WELLKNOWNNAME_TTF_REGEXP.test(markSymbolizer.wellKnownName);\n    const mark: any[] = [{\n      [WellKnownName]: [{\n        '#text': isFontSymbol ? markSymbolizer.wellKnownName : markSymbolizer.wellKnownName.toLowerCase()\n      }]\n    }];\n\n    if (markSymbolizer.color || markSymbolizer.fillOpacity) {\n      const fillCssParamaters = [];\n      if (markSymbolizer.color) {\n        if (isGeoStylerFunction(markSymbolizer.color)) {\n          const children = geoStylerFunctionToSldFunction(markSymbolizer.color);\n          fillCssParamaters.push({\n            [CssParameter]: children,\n            ':@': {\n              '@_name': 'fill'\n            }\n          });\n        } else {\n          fillCssParamaters.push({\n            [CssParameter]: [{\n              '#text': markSymbolizer.color,\n            }],\n            ':@': {\n              '@_name': 'fill'\n            }\n          });\n        }\n      }\n      if (markSymbolizer.fillOpacity) {\n        if (isGeoStylerFunction(markSymbolizer.fillOpacity)) {\n          const children = geoStylerFunctionToSldFunction(markSymbolizer.fillOpacity);\n          fillCssParamaters.push({\n            [CssParameter]: children,\n            ':@': {\n              '@_name': 'fill-opacity'\n            }\n          });\n        } else {\n          fillCssParamaters.push({\n            [CssParameter]: [{\n              '#text': markSymbolizer.fillOpacity,\n            }],\n            ':@': {\n              '@_name': 'fill-opacity'\n            }\n          });\n        }\n      }\n      mark.push({\n        [Fill]: fillCssParamaters\n      });\n    }\n\n    if (markSymbolizer.strokeColor || markSymbolizer.strokeWidth || markSymbolizer.strokeOpacity) {\n      const strokeCssParameters = [];\n      if (markSymbolizer.strokeColor) {\n        if (isGeoStylerFunction(markSymbolizer.strokeColor)) {\n          const children = geoStylerFunctionToSldFunction(markSymbolizer.strokeColor);\n          strokeCssParameters.push({\n            [CssParameter]: children,\n            ':@': {\n              '@_name': 'stroke'\n            }\n          });\n        } else {\n          strokeCssParameters.push({\n            [CssParameter]: [{\n              '#text': markSymbolizer.strokeColor,\n            }],\n            ':@': {\n              '@_name': 'stroke'\n            }\n          });\n        }\n      }\n      if (markSymbolizer.strokeWidth) {\n        if (isGeoStylerFunction(markSymbolizer.strokeWidth)) {\n          const children = geoStylerFunctionToSldFunction(markSymbolizer.strokeWidth);\n          strokeCssParameters.push({\n            [CssParameter]: children,\n            ':@': {\n              '@_name': 'stroke-width'\n            }\n          });\n        } else {\n          strokeCssParameters.push({\n            [CssParameter]: [{\n              '#text': markSymbolizer.strokeWidth,\n            }],\n            ':@': {\n              '@_name': 'stroke-width'\n            }\n          });\n        }\n      }\n      if (markSymbolizer.strokeOpacity) {\n        if (isGeoStylerFunction(markSymbolizer.strokeOpacity)) {\n          const children = geoStylerFunctionToSldFunction(markSymbolizer.strokeOpacity);\n          strokeCssParameters.push({\n            [CssParameter]: children,\n            ':@': {\n              '@_name': 'stroke-opacity'\n            }\n          });\n        } else {\n          strokeCssParameters.push({\n            [CssParameter]: [{\n              '#text': markSymbolizer.strokeOpacity,\n            }],\n            ':@': {\n              '@_name': 'stroke-opacity'\n            }\n          });\n        }\n      }\n      mark.push({\n        [Stroke]: strokeCssParameters\n      });\n    }\n\n    const graphic: any[] = [{\n      [Mark]: mark\n    }];\n\n    if (markSymbolizer.opacity) {\n      graphic.push({\n        [Opacity]: [{\n          '#text': markSymbolizer.opacity.toString()\n        }]\n      });\n    }\n\n    if (markSymbolizer.radius !== undefined) {\n      if (isGeoStylerFunction(markSymbolizer.radius)) {\n        graphic.push({\n          // TODO: Double check if we have to multiply this by 2\n          [Size]: geoStylerFunctionToSldFunction(markSymbolizer.radius)\n        });\n      } else {\n        graphic.push({\n          [Size]: [{\n            '#text': (markSymbolizer.radius * 2).toString()\n          }]\n        });\n      }\n    }\n\n    if (markSymbolizer.rotate) {\n      graphic.push({\n        [Rotation]: [{\n          '#text': markSymbolizer.rotate.toString()\n        }]\n      });\n    }\n\n    return [{\n      [Graphic]: graphic\n    }];\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style IconSymbolizer.\n   *\n   * @param iconSymbolizer A geostyler-style IconSymbolizer.\n   * @return The object representation of a SLD PointSymbolizer with\n   * an \"ExternalGraphic\" (readable with fast-xml-parser)\n   */\n  getSldPointSymbolizerFromIconSymbolizer(iconSymbolizer: GsIconSymbolizer): any {\n    const ExternalGraphic = this.getTagName('ExternalGraphic');\n    const Format = this.getTagName('Format');\n    const OnlineResource = this.getTagName('OnlineResource');\n    const Opacity = this.getTagName('Opacity');\n    const Rotation = this.getTagName('Rotation');\n    const Size = this.getTagName('Size');\n    const Graphic = this.getTagName('Graphic');\n\n    const graphic: any[] = [{\n      [ExternalGraphic]: [{\n        [OnlineResource]: [],\n        ':@': {\n          '@_xlink:type': 'simple',\n          '@_xmlns:xlink': 'http://www.w3.org/1999/xlink',\n          '@_xlink:href': iconSymbolizer.image\n        }\n      }]\n    }];\n\n    if (typeof iconSymbolizer.image === 'string' || iconSymbolizer.image instanceof String) {\n      const iconExt = iconSymbolizer.image.split('.').pop();\n      switch (iconExt) {\n        case 'png':\n        case 'jpeg':\n        case 'gif':\n          graphic[0][ExternalGraphic][0][Format] = [`image/${iconExt}`];\n          break;\n        case 'jpg':\n          graphic[0][ExternalGraphic][0][Format] = ['image/jpeg'];\n          break;\n        case 'svg':\n          graphic[0][ExternalGraphic][0][Format] = ['image/svg+xml'];\n          break;\n        default:\n          break;\n      }\n    }\n\n    if (iconSymbolizer.opacity) {\n      graphic.push({\n        [Opacity]: [{\n          '#text': iconSymbolizer.opacity\n        }]\n      });\n    }\n    if (iconSymbolizer.size) {\n      graphic.push({\n        [Size]: [{\n          '#text': iconSymbolizer.size\n        }]\n      });\n    }\n    if (iconSymbolizer.rotate) {\n      graphic.push({\n        [Rotation]: [{\n          '#text':  iconSymbolizer.rotate\n        }]\n      });\n    }\n    return [{\n      [Graphic]: graphic\n    }];\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style TextSymbolizer.\n   *\n   * @param textSymbolizer A geostyler-style TextSymbolizer.\n   * @return The object representation of a SLD TextSymbolizer (readable with fast-xml-parser)\n   */\n  getSldTextSymbolizerFromTextSymbolizer(textSymbolizer: GsTextSymbolizer): any {\n    const CssParameter = this.getTagName('CssParameter');\n    const Fill = this.getTagName('Fill');\n    const Halo = this.getTagName('Halo');\n    const Font = this.getTagName('Font');\n    const Displacement = this.getTagName('Displacement');\n    const DisplacementX = this.getTagName('DisplacementX');\n    const DisplacementY = this.getTagName('DisplacementY');\n    const LabelPlacement = this.getTagName('LabelPlacement');\n    const PointPlacement = this.getTagName('PointPlacement');\n    const Rotation = this.getTagName('Rotation');\n    const Radius = this.getTagName('Radius');\n    const Label = this.getTagName('Label');\n\n    const sldTextSymbolizer: any = [{\n      [Label]: textSymbolizer.label ? this.getSldLabelFromTextSymbolizer(textSymbolizer.label) : undefined\n    }];\n\n    const fontPropertyMap = {\n      font: 'font-family',\n      size: 'font-size',\n      fontStyle: 'font-style',\n      fontWeight: 'font-weight'\n    };\n\n    const fontCssParameters: any[] = Object.keys(textSymbolizer)\n      .filter((property: any) => property !== 'kind' && fontPropertyMap[property])\n      .map((property: any) => {\n        if (isGeoStylerFunction(textSymbolizer[property])) {\n          const children = geoStylerFunctionToSldFunction(textSymbolizer[property]);\n          return {\n            [CssParameter]: children,\n            ':@': {\n              '@_name': fontPropertyMap[property]\n            }\n          };\n        } else {\n          return {\n            [CssParameter]: [{\n              '#text': property === 'font'\n                ? textSymbolizer[property][0]\n                : textSymbolizer[property],\n            }],\n            ':@': {\n              '@_name': fontPropertyMap[property]\n            }\n          };\n        }\n      });\n\n    if (fontCssParameters.length > 0) {\n      sldTextSymbolizer.push({\n        [Font]: fontCssParameters\n      });\n    }\n\n    if (textSymbolizer.offset || textSymbolizer.rotate !== undefined) {\n      const pointPlacement: any = [];\n      if (textSymbolizer.offset) {\n        pointPlacement.push({\n          [Displacement]: [{\n            [DisplacementX]: [{\n              '#text': textSymbolizer.offset[0].toString()\n            }]\n          }, {\n            [DisplacementY]: [{\n              '#text': textSymbolizer.offset[1].toString()\n            }]\n          }]\n        });\n      }\n      if (textSymbolizer.rotate !== undefined) {\n        pointPlacement.push({\n          [Rotation]: [{\n            '#text': textSymbolizer.rotate.toString()\n          }]\n        });\n      }\n      sldTextSymbolizer.push({\n        [LabelPlacement]: [{\n          [PointPlacement]: pointPlacement\n        }]\n      });\n    }\n\n    if (textSymbolizer.haloWidth || textSymbolizer.haloColor) {\n      const halo: any = [];\n      const haloFillCssParameter = [];\n      if (textSymbolizer.haloWidth) {\n        halo.push({\n          [Radius]: [{\n            '#text': textSymbolizer.haloWidth.toString()\n          }]\n        });\n      }\n      if (textSymbolizer.haloColor) {\n        haloFillCssParameter.push({\n          [CssParameter]: [{\n            '#text': textSymbolizer.haloColor,\n          }],\n          ':@': {\n            '@_name': 'fill'\n          }\n        });\n      }\n      if (textSymbolizer.haloOpacity) {\n        haloFillCssParameter.push({\n          [CssParameter]: [{\n            '#text': textSymbolizer.haloOpacity,\n          }],\n          ':@': {\n            '@_name': 'fill-opacity'\n          }\n        });\n      }\n      if (haloFillCssParameter.length > 0) {\n        halo.push({\n          [Fill]: haloFillCssParameter\n        });\n      }\n      sldTextSymbolizer.push({\n        [Halo]: halo\n      });\n    }\n    if (textSymbolizer.color || textSymbolizer.opacity) {\n      const fill = [{\n        [CssParameter]: [{\n          '#text': textSymbolizer.color || '#000000',\n        }],\n        ':@': {\n          '@_name': 'fill'\n        }\n      },\n      {\n        [CssParameter]: [{\n          '#text': textSymbolizer.opacity || '1',\n        }],\n        ':@': {\n          '@_name': 'fill-opacity'\n        }\n      }];\n      sldTextSymbolizer.push({\n        [Fill]: fill\n      });\n    }\n\n    return sldTextSymbolizer;\n  }\n\n  /**\n   * Get the Label from a TextSymbolizer\n   *\n   * @param template The Expression<string> representing the label\n   */\n  getSldLabelFromTextSymbolizer = (template: Expression<string>): any => {\n    // TODO: parse GeoStylerFunction\n    if (!(typeof template === 'string' || template instanceof String)) {\n      return undefined;\n    }\n\n    const openingBraces = '{{';\n    const closingBraces = '}}';\n\n    const tokens = [];\n    let templateReducer = template;\n\n    while(templateReducer.length) {\n      let tmpTemplateReducer = templateReducer;\n      let tmpPreTemplateLiteral;\n      const openingBracesIdx = tmpTemplateReducer.indexOf(openingBraces);\n      if (openingBracesIdx === -1) {\n        if (templateReducer.includes(' ')) {\n          tokens.push({\n            'ogc:Literal': [{\n              '#cdata': [{\n                '#text': templateReducer\n              }]\n            }]\n          });\n        } else {\n          tokens.push({\n            'ogc:Literal': [{\n              '#text': templateReducer\n            }]\n          });\n        }\n        break;\n      }\n\n      if (openingBracesIdx > 0) {\n        tmpPreTemplateLiteral = tmpTemplateReducer.slice(0, openingBracesIdx);\n      }\n      tmpTemplateReducer = tmpTemplateReducer.slice(openingBracesIdx + openingBraces.length);\n\n      const closingBracesIdx = tmpTemplateReducer.indexOf(closingBraces);\n      if (closingBracesIdx === -1) {\n        if (templateReducer.includes(' ')) {\n          tokens.push({\n            'ogc:Literal': [{\n              '#cdata': [{\n                '#text': templateReducer\n              }]\n            }]\n          });\n        } else {\n          tokens.push({\n            'ogc:Literal': [{\n              '#text': templateReducer\n            }]\n          });\n        }\n        break;\n      }\n      const propertyName = tmpTemplateReducer.slice(0, closingBracesIdx);\n      tmpTemplateReducer = tmpTemplateReducer.slice(closingBracesIdx + closingBraces.length);\n      if (tmpPreTemplateLiteral) {\n        if (tmpPreTemplateLiteral.includes(' ')) {\n          tokens.push({\n            'ogc:Literal': [{\n              '#cdata': [{\n                '#text': tmpPreTemplateLiteral\n              }]\n            }]\n          });\n        } else {\n          tokens.push({\n            'ogc:Literal': [{\n              '#text': tmpPreTemplateLiteral\n            }]\n          });\n        }\n      }\n      tokens.push({\n        'ogc:PropertyName': [{\n          '#text': propertyName\n        }]\n      });\n      templateReducer = tmpTemplateReducer;\n    }\n\n    return tokens;\n  };\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style LineSymbolizer.\n   *\n   * @param lineSymbolizer A geostyler-style LineSymbolizer.\n   * @return The object representation of a SLD LineSymbolizer (readable with fast-xml-parser)\n   */\n  getSldLineSymbolizerFromLineSymbolizer(lineSymbolizer: GsLineSymbolizer): any[] {\n    const CssParameter = this.getTagName('CssParameter');\n    const Stroke = this.getTagName('Stroke');\n    const GraphicStroke = this.getTagName('GraphicStroke');\n    const GraphicFill = this.getTagName('GraphicFill');\n    const PerpendicularOffset = this.getTagName('PerpendicularOffset');\n\n    const propertyMap = {\n      color: 'stroke',\n      width: 'stroke-width',\n      opacity: 'stroke-opacity',\n      join: 'stroke-linejoin',\n      cap: 'stroke-linecap',\n      dasharray: 'stroke-dasharray',\n      dashOffset: 'stroke-dashoffset'\n    };\n\n    const sldLineSymbolizer: any = [];\n\n    const cssParameters: any[] = Object.keys(lineSymbolizer)\n      .filter((property: any) => property !== 'kind' && propertyMap[property] &&\n          lineSymbolizer[property] !== undefined && lineSymbolizer[property] !== null)\n      .map((property: any) => {\n        let value = lineSymbolizer[property];\n        if (property === 'dasharray') {\n          value = lineSymbolizer.dasharray ? lineSymbolizer.dasharray.join(' ') : undefined;\n\n          return {\n            [CssParameter]: [{\n              '#text': value,\n            }],\n            ':@': {\n              '@_name': propertyMap[property]\n            }\n          };\n        }\n        // simple transformation since geostyler-style uses prop 'miter' whereas sld uses 'mitre'\n        if (property === 'join' && value === 'miter') {\n          value = 'mitre';\n        }\n\n        if (isGeoStylerFunction(lineSymbolizer[property])) {\n          const children = geoStylerFunctionToSldFunction(lineSymbolizer[property]);\n          return {\n            [CssParameter]: children,\n            ':@': {\n              '@_name': propertyMap[property]\n            }\n          };\n        } else {\n          return {\n            [CssParameter]: [{\n              '#text': lineSymbolizer[property],\n            }],\n            ':@': {\n              '@_name': propertyMap[property]\n            }\n          };\n        }\n\n      });\n\n    if (lineSymbolizer?.graphicStroke) {\n      if (!Array.isArray(sldLineSymbolizer?.[0]?.[Stroke])) {\n        sldLineSymbolizer[0] = { [Stroke]: [] };\n      }\n      if (lineSymbolizer?.graphicStroke?.kind === 'Mark') {\n        const graphicStroke = this.getSldPointSymbolizerFromMarkSymbolizer(lineSymbolizer.graphicStroke);\n        sldLineSymbolizer[0][Stroke].push({\n          [GraphicStroke]: graphicStroke\n        });\n      } else if (lineSymbolizer?.graphicStroke?.kind === 'Icon') {\n        const graphicStroke = this.getSldPointSymbolizerFromIconSymbolizer(lineSymbolizer.graphicStroke);\n        sldLineSymbolizer[0][Stroke].push({\n          [GraphicStroke]: graphicStroke\n        });\n      }\n    }\n\n    if (lineSymbolizer?.graphicFill) {\n      if (!Array.isArray(sldLineSymbolizer?.[0]?.[Stroke])) {\n        sldLineSymbolizer[0] = { [Stroke]: [] };\n      }\n      if (lineSymbolizer?.graphicFill?.kind === 'Mark') {\n        const graphicFill = this.getSldPointSymbolizerFromMarkSymbolizer(lineSymbolizer.graphicFill);\n        sldLineSymbolizer[0][Stroke].push({\n          [GraphicFill]: graphicFill\n        });\n      } else if (lineSymbolizer?.graphicFill?.kind === 'Icon') {\n        const graphicFill = this.getSldPointSymbolizerFromIconSymbolizer(lineSymbolizer.graphicFill);\n        sldLineSymbolizer[0][Stroke].push({\n          [GraphicFill]: graphicFill\n        });\n      }\n    }\n\n    if (cssParameters.length !== 0) {\n      if (!Array.isArray(sldLineSymbolizer?.[0]?.[Stroke])) {\n        sldLineSymbolizer[0] = { [Stroke]: [] };\n      }\n      sldLineSymbolizer[0][Stroke].push(...cssParameters);\n    }\n    if (lineSymbolizer.perpendicularOffset) {\n      sldLineSymbolizer.push({\n        [PerpendicularOffset]: [\n          {\n            '#text': lineSymbolizer.perpendicularOffset\n          }\n        ]\n      });\n    }\n\n    if (sldLineSymbolizer.length === 0) {\n      sldLineSymbolizer.push({\n        [Stroke]: {}\n      });\n    }\n\n    return sldLineSymbolizer;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style FillSymbolizer.\n   *\n   * @param fillSymbolizer A geostyler-style FillSymbolizer.\n   * @return The object representation of a SLD PolygonSymbolizer (readable with fast-xml-parser)\n   */\n  getSldPolygonSymbolizerFromFillSymbolizer(fillSymbolizer: GsFillSymbolizer): any {\n    const CssParameter = this.getTagName('CssParameter');\n    const Stroke = this.getTagName('Stroke');\n    const Fill = this.getTagName('Fill');\n    const strokePropertyMap = {\n      outlineColor: 'stroke',\n      outlineWidth: 'stroke-width',\n      outlineOpacity: 'stroke-opacity',\n      outlineDasharray: 'stroke-dasharray',\n      outlineCap: 'stroke-linecap',\n      outlineJoin: 'stroke-linejoin'\n    };\n    const fillPropertyMap = {\n      color: 'fill',\n      fillOpacity: 'fill-opacity'\n    };\n    const strokeCssParameters: any[] = [];\n    const fillCssParameters: any[] = [];\n    let graphicFill: any;\n\n    if (fillSymbolizer?.graphicFill) {\n      if (fillSymbolizer?.graphicFill.kind === 'Mark') {\n        graphicFill = this.getSldPointSymbolizerFromMarkSymbolizer(fillSymbolizer.graphicFill);\n      } else if (fillSymbolizer?.graphicFill.kind === 'Icon') {\n        graphicFill = this.getSldPointSymbolizerFromIconSymbolizer(fillSymbolizer.graphicFill);\n      }\n    }\n\n    Object.keys(fillSymbolizer)\n      .filter((property: any) => property !== 'kind')\n      .filter((property: any) => fillSymbolizer[property] !== undefined && fillSymbolizer[property] !== null)\n      .forEach((property: any) => {\n        if (Object.keys(fillPropertyMap).includes(property)) {\n          if (isGeoStylerFunction(fillSymbolizer[property])) {\n            const children = geoStylerFunctionToSldFunction(fillSymbolizer[property]);\n            fillCssParameters.push({\n              [CssParameter]: children,\n              ':@': {\n                '@_name': fillPropertyMap[property]\n              }\n            });\n          } else {\n            fillCssParameters.push({\n              [CssParameter]: [{\n                '#text': fillSymbolizer[property],\n              }],\n              ':@': {\n                '@_name': fillPropertyMap[property]\n              }\n            });\n          }\n        } else if (Object.keys(strokePropertyMap).includes(property)) {\n\n          let transformedValue: string = '';\n\n          if (property === 'outlineDasharray') {\n            const paramValue: number[] = fillSymbolizer[property];\n            transformedValue = '';\n            paramValue.forEach((dash: number, idx) => {\n              transformedValue += dash;\n              if (idx < paramValue.length - 1) {\n                transformedValue += ' ';\n              }\n            });\n          } else if (property === 'outlineWidth') {\n            transformedValue = fillSymbolizer[property] + '';\n          }  else if (property === 'outlineOpacity') {\n            transformedValue = fillSymbolizer[property] + '';\n          } else {\n            transformedValue = fillSymbolizer[property];\n          }\n\n          if (isGeoStylerFunction(fillSymbolizer[property])) {\n            const children = geoStylerFunctionToSldFunction(fillSymbolizer[property]);\n            strokeCssParameters.push({\n              [CssParameter]: children,\n              ':@': {\n                '@_name': strokePropertyMap[property]\n              }\n            });\n          } else {\n            strokeCssParameters.push({\n              [CssParameter]: [{\n                '#text': transformedValue,\n              }],\n              ':@': {\n                '@_name': strokePropertyMap[property]\n              }\n            });\n          }\n\n        }\n      });\n\n    const polygonSymbolizer: any = [];\n    if (fillCssParameters.length > 0 || graphicFill) {\n      if (!Array.isArray(polygonSymbolizer?.[0]?.[Fill])) {\n        polygonSymbolizer[0] = { [Fill]: [] };\n      }\n      if (fillCssParameters.length > 0) {\n        polygonSymbolizer[0][Fill].push(...fillCssParameters);\n      }\n      if (graphicFill) {\n        polygonSymbolizer[0][Fill].push({\n          GraphicFill: graphicFill\n        });\n      }\n    }\n\n    if (strokeCssParameters.length > 0) {\n      polygonSymbolizer.push({\n        [Stroke]: strokeCssParameters\n      });\n    }\n\n    return polygonSymbolizer;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style RasterSymbolizer.\n   *\n   * @param rasterSymbolizer A geostyler-style RasterSymbolizer.\n   * @return The object representation of a SLD RasterSymbolizer (readable with fast-xml-parser)\n   */\n  getSldRasterSymbolizerFromRasterSymbolizer(rasterSymbolizer: GsRasterSymbolizer): any {\n    const sldRasterSymbolizer: any = [{}];\n    if (rasterSymbolizer.opacity !== undefined) {\n      sldRasterSymbolizer[0].Opacity = [{\n        '#text': rasterSymbolizer.opacity\n      }];\n    }\n\n    let colorMap: any;\n    if (rasterSymbolizer.colorMap) {\n      colorMap = this.getSldColorMapFromColorMap(rasterSymbolizer.colorMap);\n      if (colorMap?.[0]) {\n        sldRasterSymbolizer.push({\n          ColorMap: colorMap\n        });\n      }\n    }\n\n    let channelSelection: any;\n    if (rasterSymbolizer.channelSelection) {\n      channelSelection = this.getSldChannelSelectionFromChannelSelection(rasterSymbolizer.channelSelection);\n      if (channelSelection?.[0]) {\n        sldRasterSymbolizer.push({\n          ChannelSelection: channelSelection\n        });\n      }\n    }\n\n    let contrastEnhancement: any;\n    if (rasterSymbolizer.contrastEnhancement) {\n      contrastEnhancement = this.getSldContrastEnhancementFromContrastEnhancement(rasterSymbolizer.contrastEnhancement);\n      if (contrastEnhancement?.[0]) {\n        sldRasterSymbolizer.push({\n          ContrastEnhancement: contrastEnhancement\n        });\n      }\n    }\n\n    return sldRasterSymbolizer;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style ColorMap.\n   *\n   * @param colorMap A geostyler-style ColorMap.\n   * @return The object representation of a SLD ColorMap (readable with fast-xml-parser)\n   */\n  getSldColorMapFromColorMap(colorMap: ColorMap): any {\n    const sldColorMap: any[] = [];\n    // parse colorMap.type\n    if (colorMap.type) {\n      const type = colorMap.type;\n      sldColorMap[':@'] = {\n        '@_type': type\n      };\n    }\n    // parse colorMap.extended\n    if (colorMap.extended !== undefined) {\n      const extended = colorMap.extended.toString();\n      if (!sldColorMap[':@']) {\n        sldColorMap[':@'] = {};\n      }\n      sldColorMap[':@']['@_extended'] = extended;\n    }\n    // parse colorMap.colorMapEntries\n    if (colorMap.colorMapEntries && colorMap.colorMapEntries.length > 0) {\n      const colorMapEntries: any[] = colorMap.colorMapEntries.map((entry: ColorMapEntry) => {\n        const result: any = {\n          ColorMapEntry: [],\n          ':@': {}\n        };\n        if (entry.color) {\n          result[':@']['@_color'] = entry.color;\n        }\n        if (typeof entry.quantity !== 'undefined') {\n          result[':@']['@_quantity'] = entry.quantity.toString();\n        }\n        if (entry.label) {\n          result[':@']['@_label'] = entry.label;\n        }\n        if (typeof entry.opacity !== 'undefined') {\n          result[':@']['@_opacity'] = entry.opacity.toString();\n        }\n        return result;\n      // remove empty colorMapEntries\n      }).filter((entry: any) => Object.keys(entry).length > 0);\n      sldColorMap.push(...colorMapEntries);\n    }\n    return sldColorMap;\n  }\n\n  /**\n   * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style ChannelSelection.\n   *\n   * @param channelSelection A geostyler-style ChannelSelection.\n   * @return The object representation of a SLD ChannelSelection (readable with fast-xml-parser)\n   */\n  getSldChannelSelectionFromChannelSelection(channelSelection: ChannelSelection): any {\n    const propertyMap = {\n      redChannel: 'RedChannel',\n      blueChannel: 'BlueChannel',\n      greenChannel: 'GreenChannel',\n      grayChannel: 'GrayChannel'\n    };\n    const keys = Object.keys(channelSelection);\n    const sldChannelSelection: any[] = [];\n    keys.forEach((key: string) => {\n      const channel: any = [];\n      // parse sourceChannelName\n      const sourceChannelName = channelSelection?.[key]?.sourceChannelName;\n      const channelName = propertyMap[key];\n      // parse contrastEnhancement\n      const contrastEnhancement = channelSelection?.[key]?.contrastEnhancement;\n      if (sourceChannelName || contrastEnhancement) {\n        if (sourceChannelName) {\n          channel.push({\n            SourceChannelName: [{\n              '#text' :sourceChannelName\n            }]\n          });\n        }\n        if (contrastEnhancement) {\n          channel.push({\n            ContrastEnhancement: this.getSldContrastEnhancementFromContrastEnhancement(contrastEnhancement)\n          });\n        }\n        sldChannelSelection.push({\n          [channelName]: channel\n        });\n      }\n    });\n\n    return sldChannelSelection;\n  }\n\n  /**\n     * Get the SLD Object (readable with fast-xml-parser) from a geostyler-style ContrastEnhancement.\n     *\n     * @param contrastEnhancement A geostyler-style ContrastEnhancement.\n     * @return The object representation of a SLD ContrastEnhancement (readable with fast-xml-parser)\n     */\n  getSldContrastEnhancementFromContrastEnhancement(contrastEnhancement: ContrastEnhancement): any {\n    const sldContrastEnhancement: any = [];\n    const enhancementType = contrastEnhancement?.enhancementType;\n    if (enhancementType === 'normalize') {\n      // parse normalize\n      sldContrastEnhancement.push({\n        Normalize: []\n      });\n    } else if (enhancementType === 'histogram') {\n      // parse histogram\n      sldContrastEnhancement.push({\n        Histogram: []\n      });\n    }\n    // parse gammaValue\n    if (contrastEnhancement.gammaValue !== undefined) {\n      sldContrastEnhancement.push({\n        GammaValue: [{\n          '#text': contrastEnhancement.gammaValue\n        }]\n      });\n    }\n    return sldContrastEnhancement;\n  }\n\n  checkForUnsupportedProperites(geoStylerStyle: Style): UnsupportedProperties | undefined {\n    const capitalizeFirstLetter = (a: string) => a[0].toUpperCase() + a.slice(1);\n    const unsupportedProperties: UnsupportedProperties = {};\n    geoStylerStyle.rules.forEach(rule => {\n      // ScaleDenominator and Filters are completely supported so we just check for symbolizers\n      rule.symbolizers.forEach(symbolizer => {\n        const key = capitalizeFirstLetter(`${symbolizer.kind}Symbolizer`);\n        const value = this.unsupportedProperties?.Symbolizer?.[key];\n        if (value) {\n          if (typeof value === 'string' || value instanceof String) {\n            if (!unsupportedProperties.Symbolizer) {\n              unsupportedProperties.Symbolizer = {};\n            }\n            unsupportedProperties.Symbolizer[key] = value;\n          } else {\n            Object.keys(symbolizer).forEach(property => {\n              if (value[property]) {\n                if (!unsupportedProperties.Symbolizer) {\n                  unsupportedProperties.Symbolizer = {};\n                }\n                if (!unsupportedProperties.Symbolizer[key]) {\n                  unsupportedProperties.Symbolizer[key] = {};\n                }\n                unsupportedProperties.Symbolizer[key][property] = value[property];\n              }\n            });\n          }\n        }\n      });\n    });\n    if (Object.keys(unsupportedProperties).length > 0) {\n      return unsupportedProperties;\n    }\n    return undefined;\n  }\n\n}\n\nexport default SldStyleParser;\n"]}